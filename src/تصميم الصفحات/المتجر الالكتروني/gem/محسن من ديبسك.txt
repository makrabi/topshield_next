// src/pages/[locale]/store/index.tsx
import React, { useState, useEffect } from 'react';
import { NextPage } from 'next';
import Head from 'next/head';
import Image from 'next/image';
import Link from 'next/link';
import { useRouter } from 'next/router';
import { motion, AnimatePresence } from 'framer-motion';
import {
  FiArrowRight, FiShoppingCart, FiShield, FiSun, FiThermometer,
  FiFilter, FiCalendar, FiMapPin, FiStar, FiAward, FiCheck, FiMenu, FiX
} from 'react-icons/fi';
import { FaCar, FaBuilding, FaTools, FaPalette, FaCrown, FaGem } from 'react-icons/fa'; // Removed duplicate FaStar

// --- Types ---
interface Product {
  id: string;
  name: string;
  description: string;
  price: number;
  discountPrice?: number;
  image: string;
  category: string;
  vltGrade: string;
  features: string[];
  rating: number;
  reviews: number;
}

interface Service {
  id: string;
  name: string;
  description: string;
  image: string;
  link: string;
  icon: React.ReactNode;
}

// --- Header Component ---
const Header: React.FC<{
  cartItems: number;
  isMobileMenuOpen: boolean;
  setMobileMenuOpen: React.Dispatch<React.SetStateAction<boolean>>;
  currentLocale: string;
  changeLanguage: (locale: string) => void;
}> = ({ cartItems, isMobileMenuOpen, setMobileMenuOpen, currentLocale, changeLanguage }) => {
  return (
    <header className="sticky top-0 z-30 bg-white/90 backdrop-blur-sm border-b border-topshield-border-subtle/30 shadow-sm">
      <div className="container mx-auto px-4">
        <div className="flex justify-between items-center py-4">
          {/* Logo */}
          <Link href={`/${currentLocale}/store`} passHref legacyBehavior>
            <a className="flex items-center gap-2">
              <div className="bg-topshield-primary-navy text-topshield-accent-gold w-10 h-10 rounded-lg flex items-center justify-center font-bold text-xl">
                TS
              </div>
              <span className="text-xl font-bold text-topshield-primary-navy">TOPSHIELD</span>
            </a>
          </Link>

          {/* Desktop Navigation */}
          <nav className="hidden md:flex items-center gap-8">
            <Link href={`/${currentLocale}/store#car-tinting`} passHref legacyBehavior>
              <a className="text-topshield-text-medium hover:text-topshield-primary-navy font-medium flex items-center gap-1">
                <FaCar /> تظليل السيارات
              </a>
            </Link>
            <Link href={`/${currentLocale}/store#other-services`} passHref legacyBehavior>
              <a className="text-topshield-text-medium hover:text-topshield-primary-navy font-medium flex items-center gap-1">
                <FiShield /> خدمات الحماية
              </a>
            </Link>
            <Link href={`/${currentLocale}/store#technology`} passHref legacyBehavior>
              <a className="text-topshield-text-medium hover:text-topshield-primary-navy font-medium flex items-center gap-1">
                <FiAward /> تقنياتنا
              </a>
            </Link>
            <Link href={`/${currentLocale}/store#products`} passHref legacyBehavior>
              <a className="text-topshield-text-medium hover:text-topshield-primary-navy font-medium flex items-center gap-1">
                <FiShoppingCart /> جميع المنتجات
              </a>
            </Link>
          </nav>

          {/* Right Side */}
          <div className="flex items-center gap-4">
            {/* Language Switcher */}
            <div className="relative">
              <select
                value={currentLocale}
                onChange={(e) => changeLanguage(e.target.value)}
                className="bg-transparent border border-topshield-border-subtle rounded-lg py-1 px-3 text-sm focus:outline-none"
              >
                <option value="ar">العربية</option>
                <option value="en">English</option>
              </select>
            </div>

            {/* Cart */}
            <Link href={`/${currentLocale}/cart`} passHref legacyBehavior>
              <a className="relative flex items-center">
                <FiShoppingCart className="text-xl text-topshield-primary-navy" />
                {cartItems > 0 && (
                  <span className="absolute -top-1 -right-1 bg-topshield-accent-gold text-topshield-primary-navy text-xs font-bold w-5 h-5 flex items-center justify-center rounded-full">
                    {cartItems}
                  </span>
                )}
              </a>
            </Link>

            {/* Contact Button */}
            <Link href={`/${currentLocale}/contact`} passHref legacyBehavior>
              <a className="hidden md:block bg-topshield-primary-navy text-white px-4 py-2 rounded-lg font-medium hover:bg-opacity-90 transition-colors">
                اطلب عرض سعر
              </a>
            </Link>

            {/* Mobile Menu Toggle */}
            <button
              className="md:hidden text-topshield-primary-navy"
              onClick={() => setMobileMenuOpen(!isMobileMenuOpen)}
            >
              {isMobileMenuOpen ? <FiX size={24} /> : <FiMenu size={24} />}
            </button>
          </div>
        </div>
      </div>
    </header>
  );
};

// --- Footer Component ---
const Footer: React.FC<{ currentLocale: string; changeLanguage: (locale: string) => void; }> = ({ currentLocale, changeLanguage }) => {
  return (
    <footer className="bg-topshield-primary-navy text-topshield-white pt-16 pb-8">
      <div className="container mx-auto px-4">
        <div className="grid grid-cols-1 md:grid-cols-4 gap-8 mb-12">
          {/* Brand Info */}
          <div>
            <div className="flex items-center gap-2 mb-4">
              <div className="bg-topshield-accent-gold text-topshield-primary-navy w-8 h-8 rounded-lg flex items-center justify-center font-bold">
                TS
              </div>
              <span className="text-xl font-bold">TOPSHIELD</span>
            </div>
            <p className="text-topshield-border-subtle mb-4">
              الجيل الجديد من حلول الحماية والعزل الحراري الأمريكية بجودة لا مثيل لها
            </p>
            <div className="flex gap-3">
              <a href="#" className="bg-white/10 w-10 h-10 rounded-full flex items-center justify-center">
                <span className="sr-only">Facebook</span>
                <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path fillRule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z" clipRule="evenodd" />
                </svg>
              </a>
              <a href="#" className="bg-white/10 w-10 h-10 rounded-full flex items-center justify-center">
                <span className="sr-only">Instagram</span>
                <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path fillRule="evenodd" d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.067.06 1.407.06 4.123v.08c0 2.643-.012 2.987-.06 4.043-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.067.048-1.407.06-4.123.06h-.08c-2.643 0-2.987-.012-4.043-.06-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427-.047-1.024-.06-1.379-.06-3.808v-.63c0-2.43.013-2.784.06-3.808.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 015.45 2.525c.636-.247 1.363-.416 2.427-.465C8.901 2.013 9.256 2 11.685 2h.63zm-.081 1.802h-.468c-2.456 0-2.784.011-3.807.058-.975.045-1.504.207-1.857.344-.467.182-.8.398-1.15.748-.35.35-.566.683-.748 1.15-.137.353-.3.882-.344 1.857-.047 1.023-.058 1.351-.058 3.807v.468c0 2.456.011 2.784.058 3.807.045.975.207 1.504.344 1.857.182.466.399.8.748 1.15.35.35.683.566 1.15.748.353.137.882.3 1.857.344 1.054.048 1.37.058 4.041.058h.08c2.597 0 2.917-.01 3.96-.058.976-.045 1.505-.207 1.858-.344.466-.182.8-.398 1.15-.748.35-.35.566-.683.748-1.15.137-.353.3-.882.344-1.857.048-1.055.058-1.37.058-4.041v-.08c0-2.597-.01-2.917-.058-3.96-.045-.976-.207-1.505-.344-1.858a3.097 3.097 0 00-.748-1.15 3.098 3.098 0 00-1.15-.748c-.353-.137-.882-.3-1.857-.344-1.023-.047-1.351-.058-3.807-.058zM12 6.865a5.135 5.135 0 110 10.27 5.135 5.135 0 010-10.27zm0 1.802a3.333 3.333 0 100 6.666 3.333 3.333 0 000-6.666zm5.338-3.205a1.2 1.2 0 110 2.4 1.2 1.2 0 010-2.4z" clipRule="evenodd" />
                </svg>
              </a>
              <a href="#" className="bg-white/10 w-10 h-10 rounded-full flex items-center justify-center">
                <span className="sr-only">Twitter</span>
                <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84" />
                </svg>
              </a>
            </div>
          </div>

          {/* Quick Links */}
          <div>
            <h3 className="text-lg font-bold mb-4">روابط سريعة</h3>
            <ul className="space-y-2">
              <li><a href="#" className="text-topshield-border-subtle hover:text-white">الرئيسية</a></li>
              <li><a href="#" className="text-topshield-border-subtle hover:text-white">من نحن</a></li>
              <li><a href="#" className="text-topshield-border-subtle hover:text-white">خدماتنا</a></li>
              <li><a href="#" className="text-topshield-border-subtle hover:text-white">المدونة</a></li>
              <li><a href="#" className="text-topshield-border-subtle hover:text-white">اتصل بنا</a></li>
            </ul>
          </div>

          {/* Products */}
          <div>
            <h3 className="text-lg font-bold mb-4">المنتجات</h3>
            <ul className="space-y-2">
              <li><a href="#" className="text-topshield-border-subtle hover:text-white">أفلام السيارات</a></li>
              <li><a href="#" className="text-topshield-border-subtle hover:text-white">حماية الزجاج الأمامي</a></li>
              <li><a href="#" className="text-topshield-border-subtle hover:text-white">حماية الطلاء (PPF)</a></li>
              <li><a href="#" className="text-topshield-border-subtle hover:text-white">أفلام المباني</a></li>
              <li><a href="#" className="text-topshield-border-subtle hover:text-white">الإكسسوارات</a></li>
            </ul>
          </div>

          {/* Contact */}
          <div>
            <h3 className="text-lg font-bold mb-4">تواصل معنا</h3>
            <ul className="space-y-3">
              <li className="flex items-start gap-3">
                <FiMapPin className="text-topshield-accent-gold mt-1 flex-shrink-0" />
                <span className="text-topshield-border-subtle">الرياض، المملكة العربية السعودية</span>
              </li>
              <li className="flex items-center gap-3">
                <svg className="w-5 h-5 text-topshield-accent-gold flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                </svg>
                <span className="text-topshield-border-subtle">+966 11 123 4567</span>
              </li>
              <li className="flex items-center gap-3">
                <svg className="w-5 h-5 text-topshield-accent-gold flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                </svg>
                <span className="text-topshield-border-subtle">info@topshield.com</span>
              </li>
            </ul>
          </div>
        </div>

        <div className="border-t border-topshield-border-subtle/20 pt-8 text-center text-topshield-border-subtle text-sm">
          <p>© 2023 TOPSHIELD. جميع الحقوق محفوظة.</p>
        </div>
      </div>
    </footer>
  );
};

// --- Product Card Component ---
const ProductCard: React.FC<{
  product: Product;
  onAddToCart: () => void;
  currentLocale: string; // تمت إضافة اللغة الحالية كخاصية
}> = ({ product, onAddToCart, currentLocale }) => {

  // دالة لتهيئة السعر بناءً على اللغة
  const formatPriceForDisplay = (price: number) => {
    if (currentLocale === 'ar') {
      // تأكد من استخدام الأرقام العربية الشرقية للغة العربية
      return price.toLocaleString('ar-SA', { numberingSystem: 'arab' });
    }
    // للغة الإنجليزية أو أي لغات أخرى، استخدم الأرقام اللاتينية
    return price.toLocaleString('en-US');
  };

  return (
    <div className="bg-white rounded-xl overflow-hidden shadow-lg border border-topshield-border-subtle/30 hover:shadow-xl transition-shadow">
      <div className="relative h-60">
        <Image
          src={product.image}
          alt={product.name}
          layout="fill"
          objectFit="cover"
          className="transition-transform duration-500 hover:scale-105"
        />
        {product.discountPrice && (
          <div className="absolute top-4 left-4 bg-topshield-accent-gold text-topshield-primary-navy font-bold px-3 py-1 rounded-full text-sm">
            وفر {Math.round(100 - (product.discountPrice / product.price) * 100)}%
          </div>
        )}
      </div>
      
      <div className="p-6">
        <div className="flex justify-between items-start mb-3">
          <h3 className="text-xl font-bold text-topshield-primary-navy">{product.name}</h3>
          <div className="flex items-center gap-1 bg-topshield-background-light px-2 py-1 rounded text-sm">
            <FiStar className="text-topshield-accent-gold" />
            <span className="font-medium">{product.rating}</span>
            <span className="text-topshield-text-medium">({product.reviews})</span>
          </div>
        </div>
        
        <p className="text-topshield-text-medium mb-4">{product.description}</p>
        
        <div className="mb-4">
          <div className="flex items-center gap-2 mb-2">
            <div className="w-6 h-6 rounded-full border border-topshield-border-subtle flex items-center justify-center">
              <div 
                className="w-4 h-4 rounded-full" 
                style={{ 
                  backgroundColor: product.vltGrade === '35' ? '#d4af37' : 
                                   product.vltGrade === '25' ? '#1e3a8a' : 
                                   '#ffffff' 
                }}
              />
            </div>
            <span className="text-sm">درجة التظليل: {product.vltGrade}%</span>
          </div>
          
          <ul className="space-y-1 text-sm">
            {product.features.slice(0, 3).map((feature, idx) => (
              <li key={idx} className="flex items-start gap-2">
                <FiCheck className="text-topshield-accent-gold mt-0.5 flex-shrink-0" />
                <span>{feature}</span>
              </li>
            ))}
          </ul>
        </div>
        
        <div className="flex justify-between items-center">
          <div>
            {product.discountPrice ? (
              <div className="flex items-baseline gap-2">
                <span className="text-xl font-bold text-topshield-primary-navy">{formatPriceForDisplay(product.discountPrice)} ر.س</span>
                <span className="text-topshield-text-medium line-through">{formatPriceForDisplay(product.price)} ر.س</span>
              </div>
            ) : (
              <span className="text-xl font-bold text-topshield-primary-navy">{formatPriceForDisplay(product.price)} ر.س</span>
            )}
          </div>
          
          <button 
            onClick={onAddToCart}
            className="bg-topshield-primary-navy text-white px-4 py-2 rounded-lg hover:bg-opacity-90 transition-colors flex items-center gap-2"
          >
            <FiShoppingCart /> أضف للسلة
          </button>
        </div>
      </div>
    </div>
  );
};

// --- Service Card Component ---
const ServiceCard: React.FC<{ service: Service }> = ({ service }) => {
  return (
    <div className="bg-white/10 backdrop-blur-sm border border-topshield-border-subtle/30 rounded-xl p-6 h-full flex flex-col">
      <div className="text-topshield-accent-gold text-3xl mb-4">
        {service.icon}
      </div>
      <h3 className="text-xl font-bold mb-3">{service.name}</h3>
      <p className="text-topshield-border-subtle mb-6 flex-grow">{service.description}</p>
      <Link href={`/${useRouter().query.locale}${service.link}`} passHref legacyBehavior>
        <a className="flex items-center gap-2 text-topshield-accent-gold font-medium mt-auto">
          <span>اكتشف المزيد</span>
          <FiArrowRight />
        </a>
      </Link>
    </div>
  );
};

// --- Shade Visualizer Component ---
const ShadeVisualizer: React.FC<{ 
  selectedShade: string; 
  setSelectedShade: React.Dispatch<React.SetStateAction<string>>;
}> = ({ selectedShade, setSelectedShade }) => {
  const shades = [
    { value: '80', label: 'خفيف جداً', color: 'bg-gray-100' },
    { value: '50', label: 'خفيف', color: 'bg-gray-300' },
    { value: '35', label: 'متوسط', color: 'bg-gray-500' },
    { value: '20', label: 'داكن', color: 'bg-gray-700' },
    { value: '5', label: 'داكن جداً', color: 'bg-gray-900' }
  ];

  return (
    <div className="max-w-4xl mx-auto">
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-10 items-center">
        <div className="relative h-80 rounded-2xl overflow-hidden shadow-xl">
          <div className="absolute inset-0">
            <Image
              src="/images/shop/car-shade-visualizer.jpg"
              alt="Car with tinted windows"
              layout="fill"
              objectFit="cover"
            />
            <div 
              className="absolute inset-0"
              style={{ 
                backgroundColor: `rgba(0, 0, 0, ${(100 - parseInt(selectedShade)) / 200})`
              }}
            />
          </div>
          
          <div className="absolute bottom-4 left-4 bg-black/50 text-white px-4 py-2 rounded-full">
            درجة التظليل: {selectedShade}%
          </div>
        </div>
        
        <div>
          <h3 className="text-2xl font-bold mb-4">اختر درجة التظليل المثالية</h3>
          <p className="text-topshield-border-subtle mb-6">
            اختر من بين درجات التظليل المختلفة لتناسب تفضيلاتك واحتياجاتك. درجات أعلى توفر مزيداً من الخصوصية والعزل الحراري.
          </p>
          
          <div className="space-y-4">
            {shades.map((shade) => (
              <div key={shade.value} className="flex items-center gap-4">
                <button
                  onClick={() => setSelectedShade(shade.value)}
                  className={`w-12 h-12 rounded-full border-2 flex-shrink-0 ${
                    selectedShade === shade.value 
                      ? 'border-topshield-accent-gold' 
                      : 'border-topshield-border-subtle/30'
                  }`}
                >
                  <div className={`w-full h-full rounded-full ${shade.color}`} />
                </button>
                <div className="flex-grow">
                  <div className="flex justify-between">
                    <span className="font-medium">{shade.label}</span>
                    <span>{shade.value}%</span>
                  </div>
                  <div className="h-2 bg-topshield-background-light rounded-full mt-1">
                    <div 
                      className="h-full bg-topshield-accent-gold rounded-full"
                      style={{ width: `${shade.value}%` }}
                    />
                  </div>
                </div>
              </div>
            ))}
          </div>
          
          <div className="mt-8 p-4 bg-white/10 rounded-lg">
            <div className="flex items-center gap-3">
              <FiCheck className="text-topshield-accent-gold text-xl flex-shrink-0" />
              <p>
                <span className="font-bold">ملاحظة قانونية:</span> الحد القانوني لتظليل السيارات في المملكة هو 35% للزجاج الجانبي والخلفي، و70% للزجاج الأمامي.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

// --- Thermal Simulator Component ---
const ThermalSimulator: React.FC = () => {
  const [isBefore, setIsBefore] = useState(true);
  
  return (
    <div className="max-w-4xl mx-auto">
      <div className="bg-white rounded-2xl shadow-xl overflow-hidden">
        <div className="flex border-b border-topshield-border-subtle/30">
          <button
            className={`flex-1 py-4 font-bold ${
              isBefore 
                ? 'bg-topshield-primary-navy text-white' 
                : 'bg-white text-topshield-text-medium'
            }`}
            onClick={() => setIsBefore(true)}
          >
            بدون TOPSHIELD
          </button>
          <button
            className={`flex-1 py-4 font-bold ${
              !isBefore 
                ? 'bg-topshield-primary-navy text-white' 
                : 'bg-white text-topshield-text-medium'
            }`}
            onClick={() => setIsBefore(false)}
          >
            مع TOPSHIELD
          </button>
        </div>
        
        <div className="p-6">
          <div className="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
            <div className="relative h-64 rounded-xl overflow-hidden">
              <Image
                src={isBefore 
                  ? "/images/shop/car-hot-interior.jpg" 
                  : "/images/shop/car-cool-interior.jpg"}
                alt={isBefore ? "Hot car interior" : "Cool car interior"}
                layout="fill"
                objectFit="cover"
              />
              <div className="absolute bottom-4 left-4 bg-black/50 text-white px-4 py-2 rounded-full">
                {isBefore ? "65°C" : "32°C"}
              </div>
            </div>
            
            <div>
              <h3 className="text-2xl font-bold text-topshield-primary-navy mb-4">
                {isBefore ? "السيارة بدون حماية" : "السيارة مع حماية TOPSHIELD"}
              </h3>
              
              <div className="space-y-4">
                <div className="flex items-center gap-4">
                  <div className="bg-topshield-background-light w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0">
                    <FiThermometer className="text-2xl text-topshield-primary-navy" />
                  </div>
                  <div>
                    <p className="font-bold">
                      {isBefore ? "درجة حرارة مرتفعة" : "درجة حرارة مريحة"}
                    </p>
                    <p className="text-topshield-text-medium">
                      {isBefore 
                        ? "تصل إلى 65°C مما يجعل القيادة غير مريحة" 
                        : "تبقى عند 32°C حتى في أشد الأيام حرارة"}
                    </p>
                  </div>
                </div>
                
                <div className="flex items-center gap-4">
                  <div className="bg-topshield-background-light w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0">
                    <FiSun className="text-2xl text-topshield-primary-navy" />
                  </div>
                  <div>
                    <p className="font-bold">
                      {isBefore ? "أشعة فوق بنفسجية ضارة" : "حماية كاملة من الأشعة فوق البنفسجية"}
                    </p>
                    <p className="text-topshield-text-medium">
                      {isBefore 
                        ? "تعرض بشرتك وأثاث سيارتك للتلف" 
                        : "99% حماية من الأشعة فوق البنفسجية الضارة"}
                    </p>
                  </div>
                </div>
                
                <div className="flex items-center gap-4">
                  <div className="bg-topshield-background-light w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0">
                    <FaGem className="text-2xl text-topshield-primary-navy" />
                  </div>
                  <div>
                    <p className="font-bold">
                      {isBefore ? "استهلاك وقود أعلى" : "توفير في الوقود"}
                    </p>
                    <p className="text-topshield-text-medium">
                      {isBefore 
                        ? "تكييف يعمل بأقصى طاقته مما يزيد استهلاك الوقود" 
                        : "توفير يصل إلى 15% في استهلاك الوقود"}
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

// --- Filter Panel Component ---
const FilterPanel: React.FC<{
  isOpen: boolean;
  onClose: () => void;
  categories: any[]; // Consider defining a more specific type for category
  selectedCategory: string;
  setSelectedCategory: React.Dispatch<React.SetStateAction<string>>;
}> = ({ isOpen, onClose, categories, selectedCategory, setSelectedCategory }) => {
  if (!isOpen) return null;
  
  return (
    <AnimatePresence>
      <motion.div 
        className="fixed inset-0 z-50"
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        exit={{ opacity: 0 }}
      >
        {/* Overlay */}
        <div 
          className="absolute inset-0 bg-black/30"
          onClick={onClose}
        />
        
        {/* Panel */}
        <motion.div 
          className="absolute top-0 right-0 h-full w-full max-w-md bg-white shadow-xl"
          initial={{ x: '100%' }}
          animate={{ x: 0 }}
          exit={{ x: '100%' }}
          transition={{ type: 'spring', damping: 30, stiffness: 300 }}
        >
          <div className="p-6">
            <div className="flex justify-between items-center mb-8">
              <h2 className="text-2xl font-bold text-topshield-primary-navy">تصفية المنتجات</h2>
              <button 
                onClick={onClose}
                className="text-topshield-text-medium hover:text-topshield-primary-navy"
              >
                <FiX size={24} />
              </button>
            </div>
            
            <div className="mb-8">
              <h3 className="text-lg font-bold mb-4">التصنيفات</h3>
              <div className="space-y-2">
                {categories.map((category) => (
                  <button
                    key={category.id}
                    className={`flex items-center gap-3 w-full px-4 py-3 rounded-lg text-left ${
                      selectedCategory === category.id
                        ? 'bg-topshield-accent-gold/10 border border-topshield-accent-gold text-topshield-primary-navy'
                        : 'hover:bg-topshield-background-light'
                    }`}
                    onClick={() => {
                      setSelectedCategory(category.id);
                      onClose();
                    }}
                  >
                    <span className="text-topshield-accent-gold">{category.icon}</span>
                    <span>{category.name}</span>
                  </button>
                ))}
              </div>
            </div>
            
            <div>
              <h3 className="text-lg font-bold mb-4">درجة التظليل</h3>
              <div className="grid grid-cols-2 gap-3">
                {['100', '80', '50', '35', '25', '20', '5'].map((shade) => (
                  <button
                    key={shade}
                    className={`py-2 px-4 rounded-lg border ${
                      shade === '35' // This might need to be dynamic if selection is implemented
                        ? 'border-topshield-accent-gold bg-topshield-accent-gold/10 text-topshield-primary-navy font-bold'
                        : 'border-topshield-border-subtle/30 hover:bg-topshield-background-light'
                    }`}
                  >
                    {shade === '100' ? 'شفاف' : `${shade}%`}
                  </button>
                ))}
              </div>
            </div>
            
            <div className="mt-10 flex gap-3">
              <button
                className="flex-1 py-3 bg-topshield-background-light rounded-lg font-medium"
                onClick={onClose}
              >
                إلغاء
              </button>
              <button
                className="flex-1 py-3 bg-topshield-primary-navy text-white rounded-lg font-medium hover:bg-opacity-90"
                onClick={onClose} // This should probably apply the filter
              >
                تطبيق الفلتر
              </button>
            </div>
          </div>
        </motion.div>
      </motion.div>
    </AnimatePresence>
  );
};

// --- Animation Variants ---
const fadeIn = {
  hidden: { opacity: 0, y: 20 },
  visible: { opacity: 1, y: 0, transition: { duration: 0.5 } }
};

const stagger = {
  visible: {
    transition: {
      staggerChildren: 0.1
    }
  }
};

// --- Main Page Component ---
const StorePage: NextPage = () => {
  const router = useRouter();
  const { locale } = router.query;
  const currentLocale = typeof locale === 'string' ? locale : 'ar';
  
  const [isFilterOpen, setFilterOpen] = useState(false);
  const [selectedCategory, setSelectedCategory] = useState('all');
  const [selectedShade, setSelectedShade] = useState('35');
  const [cartItems, setCartItems] = useState(3);
  const [isMobileMenuOpen, setMobileMenuOpen] = useState(false);
  
  // Sample data
  const products: Product[] = [
    {
      id: 'rg-35',
      name: 'RoyalGold - درجة 35',
      description: 'فيلم عازل حراري ذهبي يوفر عزلًا حراريًا استثنائيًا مع وضوح بصري ممتاز',
      price: 1499,
      discountPrice: 1299,
      image: '/images/shop/products/royalgold-35.jpg',
      category: 'car-films',
      vltGrade: '35',
      features: ['عزل حراري فائق', 'حماية من الأشعة فوق البنفسجية 99%', 'مظهر ذهبي مميز'],
      rating: 4.8,
      reviews: 124
    },
    {
      id: 'ncir-25',
      name: 'NCIR Pro - درجة 25',
      description: 'فيلم نانو سيراميك متقدم يوفر توازنًا مثاليًا بين العزل والوضوح',
      price: 1699,
      image: '/images/shop/products/ncirpro-25.jpg',
      category: 'car-films',
      vltGrade: '25',
      features: ['رفع حرارة متقدم', 'وضوح بصري نقي', 'متانة عالية'],
      rating: 4.7,
      reviews: 98
    },
    {
      id: 'ws-protect',
      name: 'حماية الزجاج الأمامي',
      description: 'طبقة حماية متخصصة للزجاج الأمامي تقلل من خطر الكسر والخدوش',
      price: 899,
      image: '/images/shop/products/windshield-protection.jpg',
      category: 'windshield',
      vltGrade: '80',
      features: ['حماية من الصدمات', 'مقاومة للخدوش', 'شفافية عالية'],
      rating: 4.9,
      reviews: 76
    },
    {
      id: 'ppf-premium',
      name: 'فيلم حماية الطلاء (PPF)',
      description: 'درع شفاف فائق القوة لحماية طلاء سيارتك من الخدوش والحصى',
      price: 3999,
      discountPrice: 3499,
      image: '/images/shop/products/ppf-premium.jpg',
      category: 'paint-protection',
      vltGrade: '100',
      features: ['حماية متكاملة', 'شفافية عالية', 'خمس سنوات ضمان'],
      rating: 4.9,
      reviews: 68
    },
    {
      id: 'building-35',
      name: 'فيلم عزل المباني - درجة 35',
      description: 'حلول متطورة لعزل وحماية واجهات المباني الزجاجية',
      price: 1299,
      image: '/images/shop/products/building-film.jpg',
      category: 'building-films',
      vltGrade: '35',
      features: ['توفير الطاقة', 'حماية من الأشعة فوق البنفسجية', 'خصوصية مع وضوح'],
      rating: 4.6,
      reviews: 42
    }
  ];

  const services: Service[] = [
    {
      id: "installation",
      name: "خدمة التركيب الاحترافية",
      description: "فريق تركيب معتمد يقوم بتثبيت الأفلام بدقة متناهية باستخدام أحدث الأدوات",
      image: "/images/shop/services/installation.jpg",
      link: "/services/installation", // Removed /store from here, assuming currentLocale will prefix it
      icon: <FaTools />
    },
    {
      id: "warranty",
      name: "ضمان لمدة 10 سنوات",
      description: "جميع منتجاتنا تأتي بضمان لمدة 10 سنوات ضد التقشير أو تغير اللون",
      image: "/images/shop/services/warranty.jpg",
      link: "/services/warranty",
      icon: <FiAward />
    },
    {
      id: "appointment",
      name: "حجز موعد تركيب",
      description: "احجز موعد تركيب في الوقت والمكان الذي يناسبك مع فريقنا المحترف",
      image: "/images/shop/services/appointment.jpg",
      link: "/services/appointment",
      icon: <FiCalendar />
    }
  ];

  const categories = [
    { id: 'all', name: 'جميع المنتجات', icon: <FiShoppingCart /> },
    { id: 'car-films', name: 'أفلام السيارات', icon: <FaCar /> },
    { id: 'windshield', name: 'حماية الزجاج الأمامي', icon: <FiShield /> },
    { id: 'paint-protection', name: 'حماية الطلاء', icon: <FaPalette /> },
    { id: 'building-films', name: 'أفلام المباني', icon: <FaBuilding /> }
  ];

  const filteredProducts = selectedCategory === 'all' 
    ? products 
    : products.filter(product => product.category === selectedCategory);

  // Handle language change
  const changeLanguage = (newLocale: string) => {
    const path = router.asPath.substring(router.asPath.indexOf('/', 1)); // Get path without current locale
    router.push(`/${newLocale}${path}`, `/${newLocale}${path}`, { locale: newLocale });
  };

  // Handle adding to cart
  const addToCart = (productId: string) => {
    setCartItems(prev => prev + 1);
    // In a real app, this would update the cart context
    console.log(`Product ${productId} added to cart.`);
  };

  return (
    <>
      <Head>
        <title>متجر TOPSHIELD الإلكتروني - حلول الحماية المتقدمة</title>
        <meta name="description" content="تسوق أفلام العزل الحراري وحماية الطلاء الفاخرة من TOPSHIELD. منتجات أمريكية، قص بالكمبيوتر لدقة متناهية." />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <div className="min-h-screen bg-gradient-to-b from-topshield-background-light to-white font-tajawal text-topshield-text-dark dir-rtl">
        {/* Header */}
        <Header 
          cartItems={cartItems} 
          isMobileMenuOpen={isMobileMenuOpen} 
          setMobileMenuOpen={setMobileMenuOpen}
          currentLocale={currentLocale}
          changeLanguage={changeLanguage}
        />

        {/* Mobile Menu */}
        <AnimatePresence>
          {isMobileMenuOpen && (
            <motion.div 
              className="fixed inset-0 bg-topshield-primary-navy/95 z-40 pt-20"
              initial={{ opacity: 0, y: -20 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: -20 }}
              transition={{ duration: 0.3 }}
            >
              <div className="container mx-auto px-4 py-6">
                <nav className="flex flex-col space-y-6 text-xl text-topshield-white">
                  <Link href={`/${currentLocale}/store#car-tinting`} passHref legacyBehavior>
                    <a onClick={() => setMobileMenuOpen(false)} className="flex items-center gap-3 py-3 border-b border-topshield-border-subtle/30">
                      <FaCar className="text-topshield-accent-gold" />
                      تظليل السيارات
                    </a>
                  </Link>
                  <Link href={`/${currentLocale}/store#other-services`} passHref legacyBehavior>
                    <a onClick={() => setMobileMenuOpen(false)} className="flex items-center gap-3 py-3 border-b border-topshield-border-subtle/30">
                      <FiShield className="text-topshield-accent-gold" />
                      خدمات الحماية
                    </a>
                  </Link>
                  <Link href={`/${currentLocale}/store#technology`} passHref legacyBehavior>
                    <a onClick={() => setMobileMenuOpen(false)} className="flex items-center gap-3 py-3 border-b border-topshield-border-subtle/30">
                      <FiAward className="text-topshield-accent-gold" />
                      تقنياتنا
                    </a>
                  </Link>
                  <Link href={`/${currentLocale}/store#products`} passHref legacyBehavior>
                    <a onClick={() => setMobileMenuOpen(false)} className="flex items-center gap-3 py-3 border-b border-topshield-border-subtle/30">
                      <FiShoppingCart className="text-topshield-accent-gold" />
                      جميع المنتجات
                    </a>
                  </Link>
                  <Link href={`/${currentLocale}/contact`} passHref legacyBehavior>
                    <a onClick={() => setMobileMenuOpen(false)} className="bg-topshield-accent-gold text-topshield-primary-navy font-bold px-6 py-3 rounded-lg mt-4 text-center flex items-center justify-center gap-2">
                      <FiMapPin className="text-xl" />
                      اطلب عرض سعر
                    </a>
                  </Link>
                </nav>
              </div>
            </motion.div>
          )}
        </AnimatePresence>

        {/* Hero Section */}
        <motion.section 
          className="relative min-h-[80vh] flex items-center justify-center text-center text-topshield-white py-16 overflow-hidden"
          // Note: Hero background image was missing, assuming it's handled by gradient or actual image in public folder
          // style={{ backgroundImage: "url('/images/shop/hero-background.jpg')" }} // Example if image was intended
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ duration: 0.7 }}
        >
          <div className="absolute inset-0 z-0 bg-topshield-primary-navy">
             {/* Add an Image component for hero background if needed, or ensure CSS handles it */}
             {/* Example:
             <Image 
                src="/images/shop/hero-banner.jpg" // Replace with your actual hero image
                layout="fill"
                objectFit="cover"
                quality={90}
                alt="Topshield Hero Background"
                priority // Good for LCP elements
             />
             */}
            <div className="absolute inset-0 bg-gradient-to-t from-topshield-primary-navy via-topshield-primary-navy/70 to-transparent"></div>
          </div>
          
          <div className="relative z-10 container mx-auto px-4">
            <motion.div
              initial={{ y: 50, opacity: 0 }}
              animate={{ y: 0, opacity: 1 }}
              transition={{ duration: 0.8, delay: 0.2 }}
              className="inline-block bg-topshield-accent-gold/20 backdrop-blur-sm border border-topshield-accent-gold/30 rounded-full px-6 py-2 mb-6"
            >
              <span className="text-lg font-medium">حماية أمريكية بجودة عالمية</span>
            </motion.div>
            
            <motion.h1
              className="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold font-heading mb-6 leading-tight"
              initial={{ y: 50, opacity: 0 }}
              animate={{ y: 0, opacity: 1 }}
              transition={{ duration: 0.8, delay: 0.4 }}
            >
              TOPSHIELD<span className="text-topshield-accent-gold">.</span> <br />
              دقة الحماية, فخامة الأداء.
            </motion.h1>
            
            <motion.p
              className="text-xl md:text-2xl text-topshield-border-subtle max-w-3xl mx-auto mb-10"
              initial={{ y: 30, opacity: 0 }}
              animate={{ y: 0, opacity: 1 }}
              transition={{ duration: 0.8, delay: 0.6 }}
            >
              الجيل الجديد من أفلام الحماية والعزل الحراري الأمريكية، مقصوصة بالكمبيوتر بتقنية متطورة لتمنح مركبتك ومبناك درعًا غير مرئي من الأناقة والمتانة.
            </motion.p>
            
            <motion.div
              initial={{ scale: 0.7, opacity: 0 }}
              animate={{ scale: 1, opacity: 1 }}
              transition={{ duration: 0.6, delay: 0.8, type: "spring" }}
              className="flex flex-col sm:flex-row justify-center gap-4"
            >
              <Link href={`/${currentLocale}/store#products`} passHref legacyBehavior>
                <a className="bg-topshield-accent-gradient text-topshield-primary-navy font-bold text-lg px-8 py-4 rounded-xl shadow-xl hover:shadow-2xl transition-all transform hover:scale-105 inline-flex items-center justify-center gap-3">
                  <FiShoppingCart /> تصفح المنتجات
                </a>
              </Link>
              <Link href={`/${currentLocale}/store#shade-visualizer`} passHref legacyBehavior>
                <a className="bg-white/10 backdrop-blur-sm border border-topshield-border-subtle/30 text-topshield-white font-bold text-lg px-8 py-4 rounded-xl shadow-xl hover:shadow-2xl transition-all transform hover:scale-105 inline-flex items-center justify-center gap-3">
                  <FiSun /> جرب محاكي التظليل
                </a>
              </Link>
            </motion.div>
          </div>
        </motion.section>

        {/* Technology Section */}
        <section id="technology" className="py-20 md:py-28 bg-topshield-background-content">
          <div className="container mx-auto px-4">
            <div className="text-center mb-16">
              <motion.h2 
                className="text-3xl md:text-4xl lg:text-5xl font-bold font-heading text-topshield-primary-navy mb-4"
                initial="hidden"
                whileInView="visible"
                viewport={{ once: true, amount: 0.5 }}
                variants={fadeIn}
              >
                الدقة الأمريكية في خدمتك
              </motion.h2>
              <motion.p 
                className="text-lg text-topshield-text-medium max-w-2xl mx-auto"
                initial="hidden"
                whileInView="visible"
                viewport={{ once: true, amount: 0.5 }}
                variants={fadeIn}
                transition={{ delay: 0.1 }}
              >
                نجمع بين المواد الخام الأمريكية عالية الجودة وأحدث تقنيات القص بالكمبيوتر لنقدم لك حماية لا مثيل لها.
              </motion.p>
            </div>
            
            <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
              <motion.div 
                className="bg-white p-8 rounded-2xl shadow-lg border border-topshield-border-subtle/30 text-center"
                initial="hidden"
                whileInView="visible"
                viewport={{ once: true, amount: 0.5 }}
                variants={fadeIn}
              >
                <div className="w-20 h-20 mx-auto bg-topshield-accent-gold/10 rounded-full flex items-center justify-center text-3xl text-topshield-accent-gold mb-6">
                  <FiAward />
                </div>
                <h3 className="text-2xl font-bold text-topshield-primary-navy mb-3">صناعة أمريكية</h3>
                <p className="text-topshield-text-medium">
                  جميع منتجاتنا مصنوعة في الولايات المتحدة الأمريكية بأعلى معايير الجودة والسلامة العالمية.
                </p>
              </motion.div>
              
              <motion.div 
                className="bg-white p-8 rounded-2xl shadow-lg border border-topshield-border-subtle/30 text-center"
                initial="hidden"
                whileInView="visible"
                viewport={{ once: true, amount: 0.5 }}
                variants={fadeIn}
                transition={{ delay: 0.1 }}
              >
                <div className="w-20 h-20 mx-auto bg-topshield-accent-gold/10 rounded-full flex items-center justify-center text-3xl text-topshield-accent-gold mb-6">
                  <FiFilter />
                </div>
                <h3 className="text-2xl font-bold text-topshield-primary-navy mb-3">قص بالكمبيوتر</h3>
                <p className="text-topshield-text-medium">
                  يتم قص كل فيلم بدقة متناهية باستخدام أحدث تقنيات القص بالكمبيوتر لضمان التغطية المثالية.
                </p>
              </motion.div>
              
              <motion.div 
                className="bg-white p-8 rounded-2xl shadow-lg border border-topshield-border-subtle/30 text-center"
                initial="hidden"
                whileInView="visible"
                viewport={{ once: true, amount: 0.5 }}
                variants={fadeIn}
                transition={{ delay: 0.2 }}
              >
                <div className="w-20 h-20 mx-auto bg-topshield-accent-gold/10 rounded-full flex items-center justify-center text-3xl text-topshield-accent-gold mb-6">
                  <FiThermometer />
                </div>
                <h3 className="text-2xl font-bold text-topshield-primary-navy mb-3">عزل حراري متطور</h3>
                <p className="text-topshield-text-medium">
                  تقنيات متقدمة ترفض ما يصل إلى 98% من الأشعة تحت الحمراء وتخفض درجة الحرارة الداخلية بشكل ملحوظ.
                </p>
              </motion.div>
            </div>
          </div>
        </section>

        {/* Shade Visualizer */}
        <section id="shade-visualizer" className="py-20 bg-gradient-to-r from-topshield-primary-navy to-topshield-primary-blue text-topshield-white">
          <div className="container mx-auto px-4">
            <div className="text-center mb-16">
              <motion.h2 
                className="text-3xl md:text-4xl lg:text-5xl font-bold font-heading mb-4"
                initial="hidden"
                whileInView="visible"
                viewport={{ once: true, amount: 0.5 }}
                variants={fadeIn}
              >
                محاكي درجات التظليل التفاعلي
              </motion.h2>
              <motion.p 
                className="text-xl text-topshield-border-subtle max-w-2xl mx-auto"
                initial="hidden"
                whileInView="visible"
                viewport={{ once: true, amount: 0.5 }}
                variants={fadeIn}
                transition={{ delay: 0.1 }}
              >
                جرب مختلف درجات التظليل على سيارتك قبل الشراء
              </motion.p>
            </div>
            
            <ShadeVisualizer 
              selectedShade={selectedShade} 
              setSelectedShade={setSelectedShade} 
            />
          </div>
        </section>

        {/* Thermal Simulator */}
        <section className="py-20 bg-topshield-background-light">
          <div className="container mx-auto px-4">
            <div className="text-center mb-16">
              <motion.h2 
                className="text-3xl md:text-4xl lg:text-5xl font-bold font-heading text-topshield-primary-navy mb-4"
                initial="hidden"
                whileInView="visible"
                viewport={{ once: true, amount: 0.5 }}
                variants={fadeIn}
              >
                محاكي حراري واقعي
              </motion.h2>
              <motion.p 
                className="text-lg text-topshield-text-medium max-w-2xl mx-auto"
                initial="hidden"
                whileInView="visible"
                viewport={{ once: true, amount: 0.5 }}
                variants={fadeIn}
                transition={{ delay: 0.1 }}
              >
                شاهد الفرق الكبير في درجة الحرارة داخل سيارتك قبل وبعد تركيب أفلام TOPSHIELD
              </motion.p>
            </div>
            
            <ThermalSimulator />
          </div>
        </section>

        {/* Products Section */}
        <section id="products" className="py-20 bg-topshield-background-content">
          <div className="container mx-auto px-4">
            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-10">
              <div>
                <motion.h2 
                  className="text-3xl md:text-4xl lg:text-5xl font-bold font-heading text-topshield-primary-navy mb-2"
                  initial="hidden"
                  whileInView="visible"
                  viewport={{ once: true, amount: 0.5 }}
                  variants={fadeIn}
                >
                  منتجاتنا الفاخرة
                </motion.h2>
                <motion.p 
                  className="text-lg text-topshield-text-medium"
                  initial="hidden"
                  whileInView="visible"
                  viewport={{ once: true, amount: 0.5 }}
                  variants={fadeIn}
                  transition={{ delay: 0.1 }}
                >
                  حلول حماية متقدمة بجودة أمريكية
                </motion.p>
              </div>
              
              <motion.button
                className="flex items-center gap-2 bg-white border border-topshield-border-subtle px-6 py-3 rounded-lg text-topshield-primary-navy font-medium shadow-sm hover:shadow-md transition-shadow"
                onClick={() => setFilterOpen(true)}
                initial="hidden"
                whileInView="visible"
                viewport={{ once: true, amount: 0.5 }}
                variants={fadeIn}
                transition={{ delay: 0.2 }}
              >
                <FiFilter className="text-xl" /> تصفية المنتجات
              </motion.button>
            </div>
            
            {/* Category Tabs */}
            <motion.div 
              className="flex flex-wrap gap-2 mb-10"
              initial="hidden"
              whileInView="visible"
              viewport={{ once: true, amount: 0.5 }}
              variants={stagger}
            >
              {categories.map((category, index) => (
                <motion.button
                  key={category.id}
                  className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-sm font-medium transition-colors ${
                    selectedCategory === category.id
                      ? 'bg-topshield-accent-gold text-topshield-primary-navy'
                      : 'bg-white border border-topshield-border-subtle text-topshield-text-medium hover:bg-topshield-background-light'
                  }`}
                  onClick={() => setSelectedCategory(category.id)}
                  variants={fadeIn}
                  transition={{ delay: index * 0.1 }}
                >
                  {category.icon} {category.name}
                </motion.button>
              ))}
            </motion.div>
            
            {/* Products Grid */}
            <motion.div 
              className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8"
              initial="hidden"
              whileInView="visible"
              viewport={{ once: true, amount: 0.2 }}
              variants={stagger}
            >
              {filteredProducts.map((product, index) => (
                <motion.div key={product.id} variants={fadeIn} transition={{ delay: index * 0.1 }}>
                  <ProductCard 
                    product={product} 
                    onAddToCart={() => addToCart(product.id)} 
                    currentLocale={currentLocale} // تم تمرير اللغة الحالية هنا
                  />
                </motion.div>
              ))}
            </motion.div>
          </div>
        </section>

        {/* Services Section */}
        <section id="other-services" className="py-20 bg-gradient-to-r from-topshield-primary-navy to-topshield-primary-blue text-topshield-white">
          <div className="container mx-auto px-4">
            <div className="text-center mb-16">
              <motion.h2 
                className="text-3xl md:text-4xl lg:text-5xl font-bold font-heading mb-4"
                initial="hidden"
                whileInView="visible"
                viewport={{ once: true, amount: 0.5 }}
                variants={fadeIn}
              >
                خدماتنا الاحترافية
              </motion.h2>
              <motion.p 
                className="text-xl text-topshield-border-subtle max-w-2xl mx-auto"
                initial="hidden"
                whileInView="visible"
                viewport={{ once: true, amount: 0.5 }}
                variants={fadeIn}
                transition={{ delay: 0.1 }}
              >
                نقدم أكثر من مجرد منتجات، بل تجربة حماية متكاملة
              </motion.p>
            </div>
            
            <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
              {services.map((service, index) => (
                <motion.div 
                  key={service.id}
                  initial="hidden"
                  whileInView="visible"
                  viewport={{ once: true, amount: 0.5 }}
                  variants={fadeIn}
                  transition={{ delay: index * 0.2 }}
                >
                  <ServiceCard service={service} />
                </motion.div>
              ))}
            </div>
          </div>
        </section>

        {/* CTA Section */}
        <section className="py-20 bg-topshield-background-light">
          <div className="container mx-auto px-4">
            <div className="bg-gradient-to-r from-topshield-accent-gold to-topshield-accent-gold-darker rounded-3xl p-10 md:p-16 text-topshield-primary-navy text-center">
              <div className="max-w-3xl mx-auto">
                <motion.h2 
                  className="text-3xl md:text-4xl font-bold font-heading mb-6"
                  initial="hidden"
                  whileInView="visible"
                  viewport={{ once: true, amount: 0.5 }}
                  variants={fadeIn}
                >
                  هل أنت مستعد لترقية حماية ممتلكاتك؟
                </motion.h2>
                <motion.p 
                  className="text-xl mb-8"
                  initial="hidden"
                  whileInView="visible"
                  viewport={{ once: true, amount: 0.5 }}
                  variants={fadeIn}
                  transition={{ delay: 0.1 }}
                >
                  تواصل مع خبرائنا اليوم للحصول على استشارة مجانية وعرض سعر مخصص لاحتياجاتك.
                </motion.p>
                <motion.div
                  initial="hidden"
                  whileInView="visible"
                  viewport={{ once: true, amount: 0.5 }}
                  variants={fadeIn}
                  transition={{ delay: 0.2 }}
                >
                  <Link href={`/${currentLocale}/contact`} passHref legacyBehavior>
                    <a className="bg-topshield-primary-navy text-topshield-white font-bold text-xl px-12 py-4 rounded-xl shadow-xl hover:bg-opacity-90 transition-colors inline-flex items-center gap-3">
                      <FiMapPin /> احجز استشارة مجانية
                    </a>
                  </Link>
                </motion.div>
              </div>
            </div>
          </div>
        </section>

        {/* Filter Panel */}
        <FilterPanel 
          isOpen={isFilterOpen} 
          onClose={() => setFilterOpen(false)} 
          categories={categories}
          selectedCategory={selectedCategory}
          setSelectedCategory={setSelectedCategory}
        />

        {/* Footer */}
        <Footer currentLocale={currentLocale} changeLanguage={changeLanguage} />
      </div>
    </>
  );
}

export default StorePage;