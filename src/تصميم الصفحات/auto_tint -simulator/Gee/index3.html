<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محاكي تظليل وحماية السيارات - TOPSHIELD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Cairo', 'sans-serif']
                    },
                    colors: {
                        'ts-blue': '#102E6A',  
                        'ts-blue-dark': '#0A2351',
                        'ts-blue-light': '#4A6FA5',
                        'ts-gold': '#FFC107',
                        'ts-gold-light': '#FFF8E1',
                        'ts-gray': {
                            50: '#F9FAFB',
                            100: '#F3F4F6',
                            200: '#E5E7EB',
                            300: '#D1D5DB',
                            400: '#9CA3AF',
                            500: '#6B7280',
                            600: '#4B5563',
                            700: '#374151',
                            800: '#1F2937',
                            900: '#111827'
                        }
                    },
                    boxShadow: {
                        'card': '0 5px 15px rgba(0, 0, 0, 0.08)',
                        'card-hover': '0 10px 20px rgba(0, 0, 0, 0.12)',
                        'selected': '0 0 0 3px rgba(255, 193, 7, 0.6)',
                        'selected-blue': '0 0 0 3px rgba(16, 46, 106, 0.5)',
                    },
                }
            }
        }
    </script>
    <style>
        body { background-color: tailwind.config.theme.extend.colors['ts-gray'][100]; }
        .car-type-icon {
            transition: all 0.2s ease-in-out;
            min-width: 100px;
        }
        .car-type-icon.selected {
            border-color: tailwind.config.theme.extend.colors['ts-gold'] !important;
            background-color: tailwind.config.theme.extend.colors['ts-gold-light'] !important;
            box-shadow: tailwind.config.theme.extend.boxShadow['selected'];
            transform: translateY(-2px);
        }
        .car-type-icon.selected span { 
            color: tailwind.config.theme.extend.colors['ts-blue-dark']; 
            font-weight: 700; 
        }
        .tab-button.active {
            background-color: tailwind.config.theme.extend.colors['ts-blue'];
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .tint-level-button.selected {
            background-color: tailwind.config.theme.extend.colors['ts-blue-light'] !important;
            color: white !important;
            border-color: tailwind.config.theme.extend.colors['ts-blue'] !important;
            box-shadow: tailwind.config.theme.extend.boxShadow['selected-blue'];
            transform: scale(1.05);
        }
        .parts-selector input[type="checkbox"]:checked + label {
            background-color: tailwind.config.theme.extend.colors['ts-blue-light'];
            color: white;
            border-color: tailwind.config.theme.extend.colors['ts-blue'];
        }
        #car-main-preview-container {
            position: relative; 
            width: 100%;
            padding-top: 56.25%;
            background-color: #FFFFFF; 
            border-radius: 0.75rem;
            box-shadow: tailwind.config.theme.extend.boxShadow['card'];
            overflow: hidden; 
        }
        #car-main-preview-container img, 
        #car-main-preview-container #tint-effect-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain; 
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .info-tab-button.active-tab {
            border-color: tailwind.config.theme.extend.colors['ts-blue'];
            color: tailwind.config.theme.extend.colors['ts-blue-dark'];
            font-weight: 700;
        }
    </style>
</head>
<body class="text-ts-gray-700 antialiased">

<header class="bg-ts-blue text-white shadow-lg sticky top-0 z-50 h-16 flex items-center">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between w-full">
    <a href="#" class="logo flex items-center space-x-reverse space-x-2">
      <img src="icons/topshield_logo.png" alt="شعار TOPSHIELD" class="h-9 object-contain" onerror="this.src='https://placehold.co/100x40/102E6A/FFFFFF?text=LOGO&font=cairo'; this.onerror=null;">
      <span class="font-bold text-xl hidden sm:block">TOPSHIELD</span>
    </a>
    <h1 class="text-lg sm:text-xl font-bold text-center flex-grow sm:flex-grow-0 px-2">محاكي التظليل والحماية</h1>
    <button id="mobile-menu-toggle" class="md:hidden text-white hover:text-ts-gold focus:outline-none">
      <i class="fas fa-bars text-xl"></i>
    </button>
  </div>
</header>

<main class="container mx-auto p-4 lg:p-6 mt-6 mb-8">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
        <!-- Right Panel: Controls -->
        <aside class="lg:col-span-5 bg-white rounded-xl shadow-xl p-5 space-y-5 order-2 lg:order-1 overflow-y-auto no-scrollbar" style="max-height: calc(100vh - 7rem);">
            <section id="car-selector-section">
              <h2 class="text-lg font-bold text-ts-blue-dark border-b-2 border-ts-blue pb-2 mb-4 flex items-center">
                <i class="fas fa-car text-ts-blue-light mr-2.5"></i>1. اختر نوع سيارتك:
              </h2>
              <div class="car-types-grid flex flex-row flex-wrap sm:flex-nowrap justify-start gap-3">
                <div class="car-type-icon group p-3 border-2 border-ts-gray-200 rounded-xl hover:border-ts-gold hover:bg-ts-gold-light transition-all cursor-pointer text-center flex flex-col items-center flex-grow sm:flex-grow-0 sm:flex-shrink-0 basis-1/2 sm:basis-auto" 
                     data-car-type="sedan" data-car-name="سيدان">
                  <img src="icons/sedan_selector_icon.png" alt="سيدان" class="w-20 h-12 object-contain mb-1.5 transition-transform duration-200 group-hover:scale-105" onerror="this.src='https://placehold.co/80x48/cccccc/333?text=سيدان&font=cairo';this.onerror=null;">
                  <span class="text-sm font-semibold text-ts-gray-700 group-hover:text-ts-blue-dark">سيدان</span>
                </div>
                <div class="car-type-icon group p-3 border-2 border-ts-gray-200 rounded-xl hover:border-ts-gold hover:bg-ts-gold-light transition-all cursor-pointer text-center flex flex-col items-center flex-grow sm:flex-grow-0 sm:flex-shrink-0 basis-1/2 sm:basis-auto" 
                     data-car-type="suv" data-car-name="دفع رباعي">
                  <img src="icons/suv_selector_icon.png" alt="دفع رباعي" class="w-20 h-12 object-contain mb-1.5 transition-transform duration-200 group-hover:scale-105" onerror="this.src='https://placehold.co/80x48/cccccc/333?text=SUV&font=cairo';this.onerror=null;">
                  <span class="text-sm font-semibold text-ts-gray-700 group-hover:text-ts-blue-dark">دفع رباعي</span>
                </div>
                <div class="car-type-icon group p-3 border-2 border-ts-gray-200 rounded-xl hover:border-ts-gold hover:bg-ts-gold-light transition-all cursor-pointer text-center flex flex-col items-center flex-grow sm:flex-grow-0 sm:flex-shrink-0 basis-1/2 sm:basis-auto" 
                     data-car-type="sport" data-car-name="رياضية">
                  <img src="icons/sport_selector_icon.png" alt="رياضية" class="w-20 h-12 object-contain mb-1.5 transition-transform duration-200 group-hover:scale-105" onerror="this.src='https://placehold.co/80x48/cccccc/333?text=رياضية&font=cairo';this.onerror=null;">
                  <span class="text-sm font-semibold text-ts-gray-700 group-hover:text-ts-blue-dark">رياضية</span>
                </div>
                <div class="car-type-icon group p-3 border-2 border-ts-gray-200 rounded-xl hover:border-ts-gold hover:bg-ts-gold-light transition-all cursor-pointer text-center flex flex-col items-center flex-grow sm:flex-grow-0 sm:flex-shrink-0 basis-1/2 sm:basis-auto" 
                     data-car-type="truck" data-car-name="شاحنة">
                  <img src="icons/truck_selector_icon.png" alt="شاحنة" class="w-20 h-12 object-contain mb-1.5 transition-transform duration-200 group-hover:scale-105" onerror="this.src='https://placehold.co/80x48/cccccc/333?text=شاحنة&font=cairo';this.onerror=null;">
                  <span class="text-sm font-semibold text-ts-gray-700 group-hover:text-ts-blue-dark">شاحنة</span>
                </div>
              </div>
            </section>

            <section id="service-type-section" class="mt-4">
              <h2 class="text-lg font-bold text-ts-blue-dark border-b-2 border-ts-blue pb-2 mb-3 flex items-center">
                <i class="fas fa-shield-alt text-ts-blue-light mr-2.5"></i>2. اختر نوع الخدمة:
              </h2>
              <div class="tabs flex gap-2 bg-ts-gray-100 p-1 rounded-lg">
                <button class="tab-button flex-1 py-2 px-3 rounded-md text-sm font-semibold transition-all" data-service="tint">تظليل النوافذ</button>
                <button class="tab-button flex-1 py-2 px-3 rounded-md text-sm font-semibold transition-all" data-service="ppf">أفلام الحماية</button>
              </div>
            </section>

            <div id="options-panel-container" class="mt-4">
                <h3 id="current-car-selection-title" class="text-sm font-semibold text-ts-blue-dark mb-3 text-center p-2 bg-ts-gray-100 rounded-md">اختر سيارة ونوع خدمة لعرض الخيارات</h3>
                <div id="tint-options" class="options-content space-y-3 hidden">
                    <h4 class="text-sm font-bold text-ts-gray-700 flex items-center"><i class="fas fa-adjust text-ts-blue-light mr-2 text-xs"></i>خيارات تظليل النوافذ:</h4>
                    <div id="tint-level-selector">
                        <label class="block text-xs font-semibold text-ts-gray-600 mb-1">درجة التظليل العامة:</label>
                        <div class="tint-level-grid flex flex-wrap justify-center gap-1.5"></div>
                    </div>
                    <hr class="my-2 border-ts-gray-200">
                    <div>
                        <label class="block text-xs font-semibold text-ts-gray-600 mb-1">الأجزاء (اختياري):</label>
                        <div id="tint-parts-selector" class="parts-selector grid grid-cols-2 gap-1.5 text-xs"></div>
                    </div>
                </div>
                <div id="ppf-options" class="options-content space-y-3 hidden">
                    <h4 class="text-sm font-bold text-ts-gray-700 flex items-center"><i class="fas fa-film text-ts-blue-light mr-2 text-xs"></i>خيارات أفلام الحماية (PPF):</h4>
                    <div>
                        <label class="block text-xs font-semibold text-ts-gray-600 mb-1">الأجزاء المراد حمايتها:</label>
                        <div id="ppf-parts-selector" class="parts-selector grid grid-cols-2 gap-1.5 text-xs"></div>
                    </div>
                </div>
            </div>
            
            <section id="quote-section" class="mt-4 pt-3 border-t border-ts-gray-200">
              <h2 class="text-md font-bold text-ts-blue-dark mb-1.5 flex items-center">
                <i class="fas fa-calculator text-ts-blue-light mr-2"></i>3. السعر التقديري:
              </h2>
              <p class="text-lg font-bold text-ts-blue text-center py-2 bg-ts-gold-light rounded-md">
                <span id="estimated-price">0</span> ريال سعودي
              </p>
            </section>
        </aside>

        <div class="lg:col-span-7 flex flex-col gap-6 order-1 lg:order-2">
            <div id="car-main-preview-container" class="w-full">
                <div id="no-car-selected-message-main" class="absolute inset-0 flex flex-col items-center justify-center text-center text-ts-gray-400 text-md font-semibold p-5">
                    <i class="fas fa-car-side fa-3x mb-2 text-ts-gray-300"></i>
                    اختر سيارة لعرض المحاكاة.
                </div>
                <img id="previewImageBase" src="" alt="جسم السيارة" style="z-index: 10; display: none;" onerror="this.style.display='none'; document.getElementById('no-car-selected-message-main').innerHTML = 'خطأ في تحميل صورة السيارة الأساسية. يرجى التحقق من المسار: ' + this.src;">
                <div id="tint-effect-layer" style="z-index: 20; background-color: rgba(0,0,0,0.0); display: none;"></div>
                <img id="previewImageFrame" src="" alt="إطار السيارة مع زجاج شفاف" style="z-index: 30; pointer-events: none; display: none;" onerror="this.style.display='none'; document.getElementById('no-car-selected-message-main').innerHTML = 'خطأ في تحميل صورة إطار السيارة. يرجى التحقق من المسار: ' + this.src;">
            </div>

            <section id="info-tabs-section" class="bg-white p-4 sm:p-6 rounded-xl shadow-lg">
                <div id="info-tab-buttons" class="flex flex-wrap border-b border-ts-gray-200 -mx-4 px-4">
                    <button class="info-tab-button px-4 py-2 text-sm text-ts-gray-600 font-semibold border-b-2 border-transparent hover:text-ts-blue transition-colors" data-tab-target="#overview-content">نظرة عامة</button>
                    <button class="info-tab-button px-4 py-2 text-sm text-ts-gray-600 font-semibold border-b-2 border-transparent hover:text-ts-blue transition-colors" data-tab-target="#cutting-content">القص بالكمبيوتر</button>
                    <button class="info-tab-button px-4 py-2 text-sm text-ts-gray-600 font-semibold border-b-2 border-transparent hover:text-ts-blue transition-colors" data-tab-target="#specs-content">المواصفات الفنية</button>
                    <button class="info-tab-button px-4 py-2 text-sm text-ts-gray-600 font-semibold border-b-2 border-transparent hover:text-ts-blue transition-colors" data-tab-target="#benefits-content">المنافع</button>
                    <button class="info-tab-button px-4 py-2 text-sm text-ts-gray-600 font-semibold border-b-2 border-transparent hover:text-ts-blue transition-colors" data-tab-target="#warranty-content">تعليمات الضمان</button>
                </div>
                <div id="info-tab-content-container" class="mt-5 text-ts-gray-700 text-sm leading-relaxed">
                    <div id="overview-content" class="info-tab-content space-y-3">
                        <h4 class="text-lg font-bold text-ts-blue-dark">نظرة عامة</h4>
                        <p>هذا النص هو مثال لنص يمكن أن يستبدل في نفس المساحة، لقد تم توليد هذا النص من مولد النص العربى، حيث يمكنك أن تولد مثل هذا النص أو العديد من النصوص الأخرى إضافة إلى زيادة عدد الحروف التى يولدها التطبيق.</p>
                        <p>إذا كنت تحتاج إلى عدد أكبر من الفقرات يتيح لك مولد النص العربى زيادة عدد الفقرات كما تريد، النص لن يبدو مقسما ولا يحوي أخطاء لغوية.</p>
                    </div>
                    <div id="cutting-content" class="info-tab-content space-y-3 hidden">
                        <h4 class="text-lg font-bold text-ts-blue-dark">القص بالكمبيوتر</h4>
                        <p>نستخدم أحدث تقنيات القص بالكمبيوتر لضمان دقة متناهية في قص أفلام التظليل والحماية لتتناسب تمامًا مع أبعاد نوافذ وأجزاء سيارتك. هذا يضمن عدم الحاجة لاستخدام أي أدوات حادة على جسم السيارة أو الزجاج.</p>
                    </div>
                    <div id="specs-content" class="info-tab-content space-y-3 hidden">
                         <h4 class="text-lg font-bold text-ts-blue-dark">المواصفات الفنية</h4>
                        <p>مواصفات فنية تفصيلية حول أنواع الأفلام المختلفة، بما في ذلك نسبة عزل الحرارة، نفاذية الضوء المرئي، ونسبة عزل الأشعة فوق البنفسجية.</p>
                    </div>
                    <div id="benefits-content" class="info-tab-content space-y-3 hidden">
                         <h4 class="text-lg font-bold text-ts-blue-dark">المنافع</h4>
                        <ul class="list-disc pr-5 space-y-2">
                            <li>حماية فائقة من حرارة الشمس والأشعة فوق البنفسجية.</li>
                            <li>توفير في استهلاك وقود السيارة عن طريق تقليل الاعتماد على مكيف الهواء.</li>
                            <li>إضافة لمسة من الخصوصية والجمال لمظهر السيارة.</li>
                            <li>حماية فرش السيارة الداخلي من التلف والبهتان.</li>
                        </ul>
                    </div>
                    <div id="warranty-content" class="info-tab-content space-y-3 hidden">
                        <h4 class="text-lg font-bold text-ts-blue-dark">تعليمات الضمان</h4>
                        <p>نقدم ضمانًا يغطي تغير اللون، التشقق، والتقشر. للحفاظ على الضمان، يرجى اتباع تعليمات العناية الموصى بها، مثل عدم استخدام مواد كيميائية قاسية لتنظيف النوافذ والانتظار لمدة 48 ساعة بعد التركيب قبل فتح النوافذ.</p>
                    </div>
                </div>
            </section>
        </div>
    </div>
</main>

<footer class="bg-ts-blue-dark text-ts-gray-200 py-5 text-center mt-auto">
    <p class="text-xs">&copy; <span id="current-year"></span> TOPSHIELD. جميع الحقوق محفوظة.</p>
</footer>

<script>
    const carsData = {
        sedan: {
            name: "سيدان",
            icon: "icons/sedan_selector_icon.png", 
            baseImage: "images/sedan_preview.png", 
            overlayImage: "images/sedan_overlay_transparent.png", 
            tintParts: { "الزجاج الأمامي": 50, "النوافذ الجانبية الأمامية": 70, "النوافذ الجانبية الخلفية": 70, "الزجاج الخلفي": 50, "فتحة السقف": 30 },
            ppfParts: { "المقدمة كاملة": 300, "غطاء المحرك": 100, "الصدام الأمامي": 80 }
        },
        suv: { 
            name: "دفع رباعي",
            icon: "icons/suv_selector_icon.png",
            baseImage: "images/suv_preview.jpg", 
            overlayImage: "images/suv_overlay_transparent.png", 
            tintParts: { "الزجاج الأمامي": 60, "النوافذ الجانبية الأمامية": 80, "النوافذ الجانبية الخلفية": 80, "الزجاج الخلفي": 60 },
            ppfParts: { "المقدمة كاملة": 350, "غطاء المحرك": 120, "الصدام الأمامي": 90 }
        },
        sport: {
            name: "رياضية",
            icon: "icons/sport_selector_icon.png",
            baseImage: "images/sport_preview.png",
            overlayImage: "images/sport_overlay_transparent.png",
            tintParts: { "الزجاج الأمامي": 40, "النوافذ الجانبية": 100, "الزجاج الخلفي": 40 },
            ppfParts: { "المقدمة كاملة": 400, "غطاء المحرك": 150 }
        },
        truck: {
            name: "شاحنة",
            icon: "icons/truck_selector_icon.png",
            baseImage: "images/truck_preview.png",
            overlayImage: "images/truck_overlay_transparent.png",
            tintParts: { "الزجاج الأمامي": 70, "النوافذ الجانبية الأمامية": 90, "الزجاج الخلفي": 70 },
            ppfParts: { "المقدمة كاملة": 380, "غطاء المحرك": 140 }
        }
    };

    const tintLevels = [
        { name: "5%", vlt: 0.05, color: 'bg-black/95', textColor: 'text-white' },
        { name: "15%", vlt: 0.15, color: 'bg-black/85', textColor: 'text-white' },
        { name: "25%", vlt: 0.25, color: 'bg-black/75', textColor: 'text-white' },
        { name: "35%", vlt: 0.35, color: 'bg-black/65', textColor: 'text-white' },
        { name: "50%", vlt: 0.50, color: 'bg-black/50', textColor: 'text-white' },
        { name: "70%", vlt: 0.70, color: 'bg-black/30', textColor: 'text-ts-gray-800' },
        { name: "80%", vlt: 0.80, color: 'bg-black/20', textColor: 'text-ts-gray-800' },
        { name: "بدون", vlt: 1.00, color: 'bg-transparent border-dashed', textColor: 'text-ts-gray-600' }
    ];

    const carTypeIcons = document.querySelectorAll('.car-type-icon');
    const tabButtons = document.querySelectorAll('.tab-button');
    const tintOptionsDiv = document.getElementById('tint-options');
    const ppfOptionsDiv = document.getElementById('ppf-options');
    const currentCarSelectionTitle = document.getElementById('current-car-selection-title');
    const tintLevelGrid = document.querySelector('#tint-level-selector .tint-level-grid');
    const tintPartsSelector = document.getElementById('tint-parts-selector');
    const ppfPartsSelector = document.getElementById('ppf-parts-selector');
    const previewImageBase = document.getElementById('previewImageBase');
    const tintEffectLayer = document.getElementById('tint-effect-layer');
    const previewImageFrame = document.getElementById('previewImageFrame');
    const noCarMessageMain = document.getElementById('no-car-selected-message-main');
    const estimatedPriceSpan = document.getElementById('estimated-price');
    const currentYearSpan = document.getElementById('current-year');
    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    const infoTabButtons = document.querySelectorAll('.info-tab-button');
    const infoTabContents = document.querySelectorAll('.info-tab-content');

    let selectedCarType = null;
    let selectedService = 'tint'; 
    let currentGeneralVLT = 0.35; 
    let selectedTintParts = {};
    let selectedPpfParts = {};

    function updateCarSelectionDisplay() {
        const carData = carsData[selectedCarType];
        if (selectedCarType && carData) {
            currentCarSelectionTitle.textContent = `السيارة: ${carData.name} | الخدمة: ${selectedService === 'tint' ? 'تظليل' : 'حماية'}`;
            previewImageBase.src = carData.baseImage;
            previewImageFrame.src = carData.overlayImage;
            previewImageBase.style.display = 'block';
            tintEffectLayer.style.display = 'block';
            previewImageFrame.style.display = 'block';
            noCarMessageMain.style.display = 'none';
            applyTintEffect();
        } else {
            currentCarSelectionTitle.textContent = "اختر سيارة ونوع خدمة";
            previewImageBase.src = ""; 
            previewImageFrame.src = ""; 
            previewImageBase.style.display = 'none';
            tintEffectLayer.style.display = 'none';
            previewImageFrame.style.display = 'none';
            if(noCarMessageMain) noCarMessageMain.style.display = 'flex'; 
        }
        updateOptionsDisplay();
        calculatePrice();
    }

    function populateTintLevels() {
        if (!tintLevelGrid) return; 
        tintLevelGrid.innerHTML = '';
        tintLevels.forEach(level => {
            const button = document.createElement('button');
            button.className = `tint-level-button w-12 h-12 rounded-md border-2 border-ts-gray-300 flex flex-col items-center justify-center font-semibold text-xs hover:scale-105 transition-transform ${level.color} ${level.textColor}`;
            button.dataset.vlt = level.vlt;
            button.textContent = level.name;
            button.onclick = () => selectTintLevel(level.vlt, button);
            tintLevelGrid.appendChild(button);
            if (level.vlt === currentGeneralVLT) {
                button.classList.add('selected');
            }
        });
    }
    
    function selectTintLevel(vlt, element) {
        currentGeneralVLT = vlt;
        document.querySelectorAll('.tint-level-button').forEach(btn => btn.classList.remove('selected'));
        if (element) element.classList.add('selected');
        applyTintEffect();
        calculatePrice();
    }

    function applyTintEffect() {
        if (selectedService === 'tint' && selectedCarType) {
            const opacity = 1 - currentGeneralVLT;
            tintEffectLayer.style.backgroundColor = `rgba(0, 0, 0, ${opacity.toFixed(2)})`;
        } else {
            tintEffectLayer.style.backgroundColor = 'rgba(0,0,0,0)';
        }
    }

    function populateParts(service) {
        const partsSelector = service === 'tint' ? tintPartsSelector : ppfPartsSelector;
        if (!partsSelector) return; 
        partsSelector.innerHTML = '';
        const carData = carsData[selectedCarType];
        if (!carData) return;

        const parts = service === 'tint' ? carData.tintParts : carData.ppfParts;
        if (!parts) return;

        Object.keys(parts).forEach(partName => {
            const id = `${service}-${partName.replace(/\s+/g, '-')}`;
            const wrapper = document.createElement('div');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = id;
            checkbox.value = partName;
            checkbox.className = 'hidden peer'; 
            checkbox.onchange = (event) => handlePartSelection(service, partName, event.target.checked);
            
            const label = document.createElement('label');
            label.htmlFor = id;
            label.className = 'block p-2 border border-ts-gray-300 rounded-md cursor-pointer hover:bg-ts-gray-100 peer-checked:bg-ts-blue-light peer-checked:text-white peer-checked:border-ts-blue transition-colors text-center';
            label.textContent = partName;

            wrapper.appendChild(checkbox);
            wrapper.appendChild(label);
            partsSelector.appendChild(wrapper);
        });
    }
    
    function handlePartSelection(service, partName, isSelected) {
        const selectedPartsObject = service === 'tint' ? selectedTintParts : selectedPpfParts;
        if (isSelected) {
            selectedPartsObject[partName] = true;
        } else {
            delete selectedPartsObject[partName];
        }
        calculatePrice();
    }

    function updateOptionsDisplay() {
        if (selectedCarType) {
            if(tintOptionsDiv) tintOptionsDiv.style.display = selectedService === 'tint' ? 'block' : 'none';
            if(ppfOptionsDiv) ppfOptionsDiv.style.display = selectedService === 'ppf' ? 'block' : 'none';
            if (selectedService === 'tint') {
                populateTintLevels();
                populateParts('tint');
            } else {
                populateParts('ppf');
            }
        } else {
            if(tintOptionsDiv) tintOptionsDiv.style.display = 'none';
            if(ppfOptionsDiv) ppfOptionsDiv.style.display = 'none';
        }
    }
    
    function calculatePrice() {
        let totalPrice = 0;
        const carData = carsData[selectedCarType];
        if (!carData) {
            if(estimatedPriceSpan) estimatedPriceSpan.textContent = '0';
            return;
        }

        if (selectedService === 'tint') {
            if (currentGeneralVLT < 1.00 && Object.keys(selectedTintParts).length === 0) { 
                 totalPrice += 150; 
            }
            Object.keys(selectedTintParts).forEach(part => {
                if (carData.tintParts && carData.tintParts[part]) {
                    totalPrice += carData.tintParts[part];
                }
            });
        } else if (selectedService === 'ppf') {
            Object.keys(selectedPpfParts).forEach(part => {
                if (carData.ppfParts && carData.ppfParts[part]) {
                    totalPrice += carData.ppfParts[part];
                }
            });
        }
        if(estimatedPriceSpan) estimatedPriceSpan.textContent = totalPrice;
    }

    carTypeIcons.forEach(icon => {
        icon.addEventListener('click', () => {
            selectedCarType = icon.dataset.carType;
            document.querySelectorAll('.car-type-icon').forEach(i => i.classList.remove('selected'));
            icon.classList.add('selected');
            selectedTintParts = {}; 
            selectedPpfParts = {};  
            updateCarSelectionDisplay();
        });
    });

    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            selectedService = button.dataset.service;
            tabButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            currentGeneralVLT = 1.0; 
            if (selectedService === 'tint') currentGeneralVLT = 0.35; 
            selectedTintParts = {}; 
            selectedPpfParts = {};
            updateCarSelectionDisplay();
            applyTintEffect(); 
        });
    });
    
    infoTabButtons.forEach(button => {
        button.addEventListener('click', () => {
            infoTabButtons.forEach(btn => btn.classList.remove('active-tab'));
            button.classList.add('active-tab');
            const target = document.querySelector(button.dataset.tabTarget);
            infoTabContents.forEach(content => content.classList.add('hidden'));
            if (target) {
                target.classList.remove('hidden');
            }
        });
    });

    if (mobileMenuToggle && mobileMenu) { 
        mobileMenuToggle.addEventListener('click', () => {
            if (mobileMenu) mobileMenu.classList.toggle('hidden');
        });
    }
    
    if(currentYearSpan) currentYearSpan.textContent = new Date().getFullYear();
    
    document.addEventListener('DOMContentLoaded', () => {
        const suvIcon = document.querySelector('.car-type-icon[data-car-type="suv"]');
        if (suvIcon) {
            suvIcon.click(); 
        }
        
        const tintTab = document.querySelector('.tab-button[data-service="tint"]');
        if (tintTab) {
            tintTab.classList.add('active');
        }
        selectedService = 'tint'; 
        currentGeneralVLT = 0.35;

        if (!selectedCarType && suvIcon) { 
             selectedCarType = 'suv';
        }
        updateCarSelectionDisplay(); 

        if (selectedService === 'tint' && tintLevelGrid) {
             const defaultTintButton = tintLevelGrid.querySelector(`.tint-level-button[data-vlt="${currentGeneralVLT}"]`);
             if (defaultTintButton) {
                 selectTintLevel(currentGeneralVLT, defaultTintButton);
             }
        }
        
        if(infoTabButtons.length > 0) {
            infoTabButtons[0].click();
        }
    });

</script>
</body>
</html>
