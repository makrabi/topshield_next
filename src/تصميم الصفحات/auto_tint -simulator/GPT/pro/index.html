<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>محاكي تظليل السيارات – TOPSHIELD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
    <style>
        body{font-family:'Cairo',sans-serif;background:#F3F4F6}
        .car-btn{transition:.2s;border:2px solid #E5E7EB;border-radius:.75rem;padding:.5rem 1rem;display:flex;flex-direction:column;align-items:center;width:100px;cursor:pointer}
        .car-btn.selected{border-color:#FFC107;background:#FFF8E1;transform:translateY(-2px)}
        .tint-btn{width:3.5rem;height:3.5rem;border:2px solid #E5E7EB;border-radius:.5rem;display:flex;align-items:center;justify-content:center;cursor:pointer;font-weight:700}
        .tint-btn.selected{border-color:#102E6A;background:#4A6FA5;color:#fff}

        #viewer{position:relative;width:100%;padding-top:56.25%;background:#fff;border-radius:.75rem;overflow:hidden;box-shadow:0 5px 15px rgba(0,0,0,.08)}
        #viewer img, #viewer #tintLayer {
            position:absolute;
            inset:0;
            width:100%;
            height:100%;
            object-fit:contain;
        }
        #baseImg { z-index: 10; }
        #tintLayer {
            z-index: 20;
            background-color: black;
            /* This is the key change: We use the frame image as a mask */
            mask-image: var(--frame-mask-url);
            -webkit-mask-image: var(--frame-mask-url);
            mask-size: contain;
            -webkit-mask-size: contain;
            mask-repeat: no-repeat;
            -webkit-mask-repeat: no-repeat;
            mask-position: center;
            -webkit-mask-position: center;
        }
        /* frameImg is now only used to load the mask, it is not displayed */
        #frameImg { display: none; }
    </style>
</head>
<body class="text-gray-700">

<header class="bg-[#102E6A] text-white h-14 flex items-center shadow-md sticky top-0 z-50">
  <div class="container mx-auto px-4 flex justify-between w-full">
    <span class="font-bold hidden md:block">TOPSHIELD</span>
    <h1 class="font-bold text-base md:text-lg">محاكي التظليل والحماية</h1>
  </div>
</header>

<main class="container mx-auto p-4 lg:p-6 grid lg:grid-cols-12 gap-6">
    <!-- لوحة التحكم -->
    <aside class="lg:col-span-4 space-y-6">
        <section class="bg-white rounded-xl shadow p-4 space-y-3">
            <h2 class="font-bold text-[#0A2351] text-lg">① اختر نوع سيارتك</h2>
            <div class="flex gap-3 flex-wrap">
                <div class="car-btn" id="sedanBtn" onclick="selectCar('sedan',this)">
                    <img src="icons/sedan_selector_icon.png" class="w-12 h-10 object-contain mb-1" onerror="this.src='https://placehold.co/80x48/cccccc/333?text=سيدان&font=cairo'"/>
                    <span>سيدان</span>
                </div>
            </div>
        </section>

        <section class="bg-white rounded-xl shadow p-4 space-y-3">
            <h2 class="font-bold text-[#0A2351] text-lg">② درجة التظليل</h2>
            <div class="flex gap-2 flex-wrap">
                <div class="tint-btn" onclick="selectTint(0.05,this)">5%</div>
                <div class="tint-btn" onclick="selectTint(0.20,this)">20%</div>
                <div class="tint-btn" onclick="selectTint(0.35,this)">35%</div>
                <div class="tint-btn" onclick="selectTint(0.50,this)">50%</div>
                <div class="tint-btn" onclick="selectTint(0.70,this)">70%</div>
                <div class="tint-btn" onclick="selectTint(1.00,this)">شفاف</div>
            </div>
        </section>
    </aside>

    <!-- المعاينة -->
    <section class="lg:col-span-8">
        <div id="viewer">
            <div id="placeholder" class="absolute inset-0 flex items-center justify-center text-gray-300 text-lg font-bold">
                اختر سيارة لعرض المحاكاة
            </div>
            <!-- Layer 1: Base car image (Always visible) -->
            <img id="baseImg"  src="" alt="Base" style="display:none;z-index:10">
            <!-- Layer 2: The tint color layer. Its visibility is controlled by the mask. -->
            <div id="tintLayer" style="display:none;"></div>
            <!-- This image is hidden. It's only loaded to be used by the CSS mask property. -->
            <img id="frameImg" src="" alt="Frame Mask" style="display:none;">
        </div>
    </section>
</main>

<script>
const cars={
    sedan:{
        base:'images/sedan_base.png',      
        // IMPORTANT: 'frame' must now be a MASK image.
        // Windows should be WHITE, and everything else (car body, background) should be BLACK.
        frame:'images/sedan_frame.png'    
    }
};

const baseImg     = document.getElementById('baseImg');
const tintLayer   = document.getElementById('tintLayer');
const frameImg    = document.getElementById('frameImg'); // We still need to load it
const placeholder = document.getElementById('placeholder');
const viewer = document.getElementById('viewer');

function selectCar(key,btn){
    document.querySelectorAll('.car-btn').forEach(b=>b.classList.remove('selected'));
    btn.classList.add('selected');

    const car = cars[key];
    baseImg.src  = car.base;
    // Set the source of the hidden frame image so the CSS mask can load it
    frameImg.src = car.frame;
    
    // Use the frame image as a CSS variable for the mask
    tintLayer.style.setProperty('--frame-mask-url', `url(${car.frame})`);

    baseImg.style.display='block';
    tintLayer.style.display='block';
    placeholder.style.display='none';
}

function selectTint(vlt,btn){
    document.querySelectorAll('.tint-btn').forEach(b=>b.classList.remove('selected'));
    btn.classList.add('selected');
    
    // We now change the opacity of the #tintLayer div.
    // Since it's masked, the opacity change will only be visible through the white areas of the mask (the windows).
    const overlayOpacity = 1 - vlt;
    tintLayer.style.opacity = overlayOpacity.toFixed(2);
}

window.addEventListener('DOMContentLoaded',()=>{
    document.getElementById('sedanBtn').click();        
    document.querySelectorAll('.tint-btn')[2].click();
});
</script>
</body>
</html>
