<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOPSHIELD - محاكي التظليل المطور</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #F8F9FA; /* خلفية الصفحة الرئيسية - رمادي فاتح جداً */
        }
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'ts-blue': '#102E6A',
                        'ts-blue-dark': '#0A2351', /* أغمق قليلاً من الأزرق الرئيسي */
                        'ts-gold': '#FFC107',
                        'ts-light-gold': '#FFF8E1', /* ذهبي فاتح جداً للخلفيات المختارة */
                        'ts-gray': {
                            50: '#F9FAFB',
                            100: '#F3F4F6',
                            200: '#E5E7EB',
                            300: '#D1D5DB',
                            400: '#9CA3AF',
                            500: '#6B7280',
                            600: '#4B5563',
                            700: '#374151',
                            800: '#1F2937',
                            900: '#111827',
                        },
                    }
                }
            }
        }

        .selected-vehicle {
            border-color: tailwind.theme.colors['ts-gold'] !important;
            background-color: tailwind.theme.colors['ts-light-gold'] !important;
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.25);
            transform: translateY(-2px);
        }
        .selected-vehicle img {
            filter: none;
            opacity: 1;
        }
        .selected-vehicle .vehicle-name {
            color: tailwind.theme.colors['ts-blue-dark'];
            font-weight: 700;
        }
        .selected-tint {
            border-color: tailwind.theme.colors['ts-blue'] !important; 
            background-color: #EBF4FF !important; /* أزرق فاتح جداً للخلفية المختارة */
            box-shadow: 0 2px 8px rgba(16, 46, 106, 0.2);
            transform: translateY(-1px);
        }
        .selected-tint .tint-value {
            color: tailwind.theme.colors['ts-blue-dark'];
            font-weight: 700;
        }
        .vlt-description-display.visible {
            opacity: 1;
            max-height: 100px; 
            margin-top: 0.375rem; /* mt-1.5 */
            padding: 0.5rem 0.75rem; /* p-2 px-3 */
            font-size: 0.75rem; /* text-xs */
            background-color: #EFF6FF; /* خلفية وصف التظليل - أزرق فاتح جداً */
            border-radius: 0.375rem; /* rounded-md */
            color: #374151; /* ts-gray-700 */
        }
        .btn-next {
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
        }
        .btn-next .arrow-icon {
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        html[dir="rtl"] .btn-next:hover:not(:disabled) .arrow-icon {
            transform: translateX(5px);
        }
        html[dir="ltr"] .btn-next:hover:not(:disabled) .arrow-icon {
            transform: translateX(-5px);
        }
        .btn-next:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(16, 46, 106, 0.2);
        }


        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        #alert-message-container {
            position: fixed; top: 20px; left: 50%;
            transform: translateX(-50%); z-index: 1000;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        .alert-message {
            padding: 0.875rem 1.25rem; border-radius: 0.5rem; /* rounded-lg */
            font-weight: 600; font-size: 0.875rem; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); 
        }
        .alert-error {
            background-color: #FFF1F2; color: #E11D48; border: 1px solid #FECDD3; 
        }
         .alert-success { 
            background-color: #F0FDF4; color: #16A34A; border: 1px solid #BBF7D0; 
        }
        .tint-button .tint-square { 
            width: 36px; 
            height: 30px; 
            margin-bottom: 0.25rem; 
            border-radius: 0.375rem; /* rounded-md */
            border: 1px solid #D1D5DB; /* ts-gray-300 */
            background-clip: padding-box; 
            transition: transform 0.2s ease;
        }
        .tint-button:hover .tint-square {
            transform: scale(1.05);
        }
        .controls-area {
            max-height: calc(100vh - 4rem - 2.5rem); /* header (4rem) + main py (1.25rem*2 = 2.5rem) */
        }
        .control-section > h3 {
            color: tailwind.theme.colors['ts-blue-dark'];
            border-bottom-width: 2px;
            border-color: tailwind.theme.colors['ts-blue'];
            padding-bottom: 0.5rem; /* pb-2 */
            margin-bottom: 0.75rem; /* mb-3 */
        }
        .glass-tint-section h4 {
            color: tailwind.theme.colors['ts-gray'][700];
        }
        .vlt-select {
            border-color: tailwind.theme.colors['ts-gray'][300];
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .vlt-select:focus {
            border-color: tailwind.theme.colors['ts-blue'];
            box-shadow: 0 0 0 2px rgba(16, 46, 106, 0.2);
            outline: none;
        }
    </style>
</head>
<body class="bg-ts-gray-50 text-ts-gray-800">
    <div id="alert-message-container" class="opacity-0 transform -translate-y-10"></div>

    <div class="simulator-container flex flex-col min-h-screen">
        <header class="bg-ts-blue text-white shadow-md sticky top-0 z-50 h-16">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-full">
                    <a href="#" class="logo-link">
                        <img src="https://assets.stickpng.com/images/580b57fcd9996e24bc43c521.png" alt="شعار Topshield" class="header-logo h-8 sm:h-9 object-contain">
                    </a>
                    <nav class="hidden md:flex space-x-reverse space-x-3">
                        <a href="#" class="hover:text-ts-gold transition-colors duration-200 px-3 py-2 rounded-md text-sm font-medium">الصفحة الرئيسية</a>
                        <a href="#" class="hover:text-ts-gold transition-colors duration-200 px-3 py-2 rounded-md text-sm font-medium">عنا</a>
                        <a href="#" class="text-ts-gold font-semibold border-b-2 border-ts-gold px-3 py-2 text-sm">العازل الحراري للسيارات</a>
                        <a href="#" class="hover:text-ts-gold transition-colors duration-200 px-3 py-2 rounded-md text-sm font-medium">أفلام حماية الطلاء</a>
                        <a href="#" class="hover:text-ts-gold transition-colors duration-200 px-3 py-2 rounded-md text-sm font-medium">افلام الحماية الملونة</a>
                    </nav>
                    <div class="md:hidden">
                        <button id="mobile-menu-button" class="text-white hover:text-ts-gold focus:outline-none">
                            <i class="fas fa-bars text-lg"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div id="mobile-menu" class="md:hidden hidden bg-ts-blue-dark shadow-lg">
                <a href="#" class="block hover:bg-ts-blue px-4 py-3 text-sm font-medium text-center">الصفحة الرئيسية</a>
                <a href="#" class="block hover:bg-ts-blue px-4 py-3 text-sm font-medium text-center">عنا</a>
                <a href="#" class="block bg-ts-blue text-ts-gold font-semibold px-4 py-3 text-sm text-center">العازل الحراري للسيارات</a>
                <a href="#" class="block hover:bg-ts-blue px-4 py-3 text-sm font-medium text-center">أفلام حماية الطلاء</a>
                <a href="#" class="block hover:bg-ts-blue px-4 py-3 text-sm font-medium text-center">افلام الحماية الملونة</a>
            </div>
        </header>

        <main class="simulator-body container mx-auto p-3 md:p-4 lg:px-6 lg:py-5 flex flex-col lg:flex-row gap-5 flex-grow">
            <aside class="controls-area lg:w-5/12 xl:w-4/12 bg-white p-4 rounded-xl shadow-xl order-2 lg:order-1 overflow-y-auto no-scrollbar">
                <section class="control-section mb-4"> 
                    <h3 class="text-base font-bold">1. اختر نوع المركبة</h3> 
                    <div class="vehicle-type-options grid grid-cols-4 gap-2 mt-2.5"> 
                        <div class="vehicle-option flex flex-col items-center p-2.5 border-2 border-ts-gray-200 rounded-lg cursor-pointer bg-ts-gray-50 hover:border-ts-gold hover:bg-ts-light-gold transition-all duration-200 ease-in-out" data-car-name="رياضية" data-preview-image="https://placehold.co/800x500/e0e0e0/333?text=سيارة+رياضية&font=cairo" onclick="selectCar('رياضية', this.dataset.previewImage, this)">
                            <img loading="lazy" src="https://placehold.co/70x45/cccccc/555555?text=رياضية&font=cairo" alt="رياضية" class="w-16 h-10 object-contain mb-1 filter grayscale opacity-70 group-hover:opacity-100 group-hover:filter-none transition-all duration-200" onerror="this.src='https://placehold.co/70x45/e9ecef/212529?text=رياضية&font=cairo'; this.onerror=null;">
                            <span class="vehicle-name text-xs font-semibold text-ts-gray-600">رياضية</span>
                        </div>
                        <div class="vehicle-option flex flex-col items-center p-2.5 border-2 border-ts-gray-200 rounded-lg cursor-pointer bg-ts-gray-50 hover:border-ts-gold hover:bg-ts-light-gold transition-all duration-200 ease-in-out" data-car-name="سيدان" data-preview-image="https://placehold.co/800x500/e0e0e0/333?text=سيارة+سيدان&font=cairo" onclick="selectCar('سيدان', this.dataset.previewImage, this)">
                            <img loading="lazy" src="https://placehold.co/70x45/cccccc/555555?text=سيدان&font=cairo" alt="سيدان" class="w-16 h-10 object-contain mb-1 filter grayscale opacity-70 group-hover:opacity-100 group-hover:filter-none transition-all duration-200" onerror="this.src='https://placehold.co/70x45/e9ecef/212529?text=سيدان&font=cairo'; this.onerror=null;">
                            <span class="vehicle-name text-xs font-semibold text-ts-gray-600">سيدان</span>
                        </div>
                        <div class="vehicle-option flex flex-col items-center p-2.5 border-2 border-ts-gray-200 rounded-lg cursor-pointer bg-ts-gray-50 hover:border-ts-gold hover:bg-ts-light-gold transition-all duration-200 ease-in-out" data-car-name="عائلية/دفع رباعي" data-preview-image="https://placehold.co/800x500/e0e0e0/333?text=SUV&font=cairo" onclick="selectCar('عائلية/دفع رباعي', this.dataset.previewImage, this)">
                            <img loading="lazy" src="https://placehold.co/70x45/cccccc/555555?text=SUV&font=cairo" alt="عائلية/دفع رباعي" class="w-16 h-10 object-contain mb-1 filter grayscale opacity-70 group-hover:opacity-100 group-hover:filter-none transition-all duration-200" onerror="this.src='https://placehold.co/70x45/e9ecef/212529?text=SUV&font=cairo'; this.onerror=null;">
                            <span class="vehicle-name text-xs font-semibold text-ts-gray-600">عائلية/دفع رباعي</span>
                        </div>
                        <div class="vehicle-option flex flex-col items-center p-2.5 border-2 border-ts-gray-200 rounded-lg cursor-pointer bg-ts-gray-50 hover:border-ts-gold hover:bg-ts-light-gold transition-all duration-200 ease-in-out" data-car-name="شاحنة" data-preview-image="https://placehold.co/800x500/e0e0e0/333?text=شاحنة&font=cairo" onclick="selectCar('شاحنة', this.dataset.previewImage, this)">
                            <img loading="lazy" src="https://placehold.co/70x45/cccccc/555555?text=شاحنة&font=cairo" alt="شاحنة" class="w-16 h-10 object-contain mb-1 filter grayscale opacity-70 group-hover:opacity-100 group-hover:filter-none transition-all duration-200" onerror="this.src='https://placehold.co/70x45/e9ecef/212529?text=شاحنة&font=cairo'; this.onerror=null;">
                            <span class="vehicle-name text-xs font-semibold text-ts-gray-600">شاحنة</span>
                        </div>
                    </div>
                </section>

                <section class="control-section mb-4"> 
                    <h3 class="text-base font-bold">2. اختر المظهر العام <span class="text-sm font-normal text-ts-gray-500">(VLT)</span></h3> 
                    <p id="tintLabel" class="text-xs text-ts-gray-600 mt-1.5 mb-2 text-center"></p> 
                    <div class="tint-percentage-options flex flex-row flex-nowrap gap-1.5 overflow-x-auto py-1.5 no-scrollbar"> 
                        <div class="tint-button flex flex-col items-center p-1.5 border-2 border-ts-gray-200 rounded-lg cursor-pointer bg-ts-gray-50 hover:border-ts-blue transition-all duration-200 ease-in-out flex-shrink-0" data-vlt="0.05" onclick="selectTint(0.05, this)">
                            <div class="tint-square" style="background-color: rgba(0,0,0,0.95);"></div><span class="tint-value text-xs">5%</span>
                        </div>
                        <div class="tint-button flex flex-col items-center p-1.5 border-2 border-ts-gray-200 rounded-lg cursor-pointer bg-ts-gray-50 hover:border-ts-blue transition-all duration-200 ease-in-out flex-shrink-0" data-vlt="0.15" onclick="selectTint(0.15, this)">
                            <div class="tint-square" style="background-color: rgba(0,0,0,0.85);"></div><span class="tint-value text-xs">15%</span>
                        </div>
                         <div class="tint-button flex flex-col items-center p-1.5 border-2 border-ts-gray-200 rounded-lg cursor-pointer bg-ts-gray-50 hover:border-ts-blue transition-all duration-200 ease-in-out flex-shrink-0" data-vlt="0.25" onclick="selectTint(0.25, this)">
                            <div class="tint-square" style="background-color: rgba(0,0,0,0.75);"></div><span class="tint-value text-xs">25%</span>
                        </div>
                        <div class="tint-button flex flex-col items-center p-1.5 border-2 border-ts-gray-200 rounded-lg cursor-pointer bg-ts-gray-50 hover:border-ts-blue transition-all duration-200 ease-in-out flex-shrink-0" data-vlt="0.35" onclick="selectTint(0.35, this)">
                            <div class="tint-square" style="background-color: rgba(0,0,0,0.65);"></div><span class="tint-value text-xs">35%</span>
                        </div>
                        <div class="tint-button flex flex-col items-center p-1.5 border-2 border-ts-gray-200 rounded-lg cursor-pointer bg-ts-gray-50 hover:border-ts-blue transition-all duration-200 ease-in-out flex-shrink-0" data-vlt="0.50" onclick="selectTint(0.50, this)">
                            <div class="tint-square" style="background-color: rgba(0,0,0,0.50);"></div><span class="tint-value text-xs">50%</span>
                        </div>
                        <div class="tint-button flex flex-col items-center p-1.5 border-2 border-ts-gray-200 rounded-lg cursor-pointer bg-ts-gray-50 hover:border-ts-blue transition-all duration-200 ease-in-out flex-shrink-0" data-vlt="0.70" onclick="selectTint(0.70, this)">
                            <div class="tint-square" style="background-color: rgba(0,0,0,0.30);"></div><span class="tint-value text-xs">70%</span>
                        </div>
                        <div class="tint-button flex flex-col items-center p-1.5 border-2 border-ts-gray-200 rounded-lg cursor-pointer bg-ts-gray-50 hover:border-ts-blue transition-all duration-200 ease-in-out flex-shrink-0" data-vlt="0.80" onclick="selectTint(0.80, this)">
                            <div class="tint-square" style="background-color: rgba(0,0,0,0.20);"></div><span class="tint-value text-xs">80%</span>
                        </div>
                        <div class="tint-button flex flex-col items-center p-1.5 border-2 border-ts-gray-200 rounded-lg cursor-pointer bg-ts-gray-50 hover:border-ts-blue transition-all duration-200 ease-in-out flex-shrink-0" data-vlt="1.00" onclick="selectTint(1.00, this)">
                            <div class="tint-square" style="background-color: rgba(0,0,0,0.0);"></div><span class="tint-value text-xs">بدون</span>
                        </div>
                    </div>
                </section>

                <section class="control-section detailed-tint-selection mb-4"> 
                    <h3 class="text-base font-bold">3. اختر درجة التظليل المفضلة لديك <span class="text-sm font-normal text-ts-gray-500">(لكل زجاج)</span></h3> 
                    
                    <div class="glass-tint-section mt-2.5 mb-2 pb-2 border-b border-ts-gray-200" id="windshield-section"> 
                        <div class="flex justify-between items-center mb-1"> 
                            <h4 class="text-sm font-semibold flex items-center whitespace-nowrap"><i class="fas fa-window-maximize fa-fw glass-icon ml-1.5 text-ts-blue text-sm"></i>الزجاج الامامي*</h4>
                            <select class="vlt-select w-full p-2 border rounded-md bg-white text-xs mr-2" id="windshield_vlt" name="windshield_vlt"> 
                                <option value="" data-description="" selected>اختر درجة</option>
                                <option value="0.80" data-description="شفاف تمامًا وغير ملحوظ تقريبًا (مطابق للأنظمة)">80%</option>
                                <option value="0.70" data-description="شفاف وبالكاد يٌلاحظ (مطابق للأنظمة)">70%</option>
                            </select>
                        </div>
                        <div class="vlt-description-display" id="windshield_vlt_desc"></div>
                    </div>

                    <div class="glass-tint-section mb-2 pb-2 border-b border-ts-gray-200" id="front-doors-section">
                        <div class="flex justify-between items-center mb-1">
                             <h4 class="text-sm font-semibold flex items-center whitespace-nowrap"><i class="fas fa-car-side fa-fw glass-icon ml-1.5 text-ts-blue text-sm"></i>زجاج البابين الأماميين</h4>
                            <select class="vlt-select w-full p-2 border rounded-md bg-white text-xs mr-2" id="front_doors_vlt" name="front_doors_vlt">
                                <option value="" data-description="" selected>اختر درجة</option>
                                <option value="0.80" data-description="شفاف تمامًا وغير ملحوظ تقريبًا (مطابق للأنظمة)">80%</option>
                                <option value="0.70" data-description="شفاف بالكاد يٌلاحظ (مطابق للأنظمة)">70%</option>
                                <option value="0.50" data-description="تعتيم خفيف توازن أنيق (مطابق للأنظمة)">50%</option>
                                <option value="0.35" data-description="تعتيم متوسط لمسة جمالية راقية (مطابق للأنظمة)">35%</option>
                                <option value="0.25" data-description="تعتيم عالي خصوصية وأناقة ملفتة">25%</option>
                                <option value="0.15" data-description="تعتيم شديد خصوصية عالية جذابة بدون كتم">15%</option>
                                <option value="0.05" data-description="تعتيم تام حجب كامل للرؤية من الخارج للداخل">5%</option>
                            </select>
                        </div>
                        <div class="vlt-description-display" id="front_doors_vlt_desc"></div>
                    </div>
                    
                    <div class="glass-tint-section mb-2 pb-2 border-b border-ts-gray-200" id="rear-doors-section">
                        <div class="flex justify-between items-center mb-1">
                            <h4 class="text-sm font-semibold flex items-center whitespace-nowrap"><i class="fas fa-car-side fa-fw glass-icon ml-1.5 text-ts-blue text-sm" style="transform: scaleX(-1);"></i>زجاج البابين الخلفيين*</h4>
                            <select class="vlt-select w-full p-2 border rounded-md bg-white text-xs mr-2" id="rear_doors_vlt" name="rear_doors_vlt">
                                <option value="0.80" data-description="شفاف تمامًا وغير ملحوظ تقريبًا (مطابق للأنظمة)">80%</option>
                                <option value="0.70" data-description="شفاف بالكاد يٌلاحظ (مطابق للأنظمة)">70%</option>
                                <option value="0.50" data-description="تعتيم خفيف توازن أنيق (مطابق للأنظمة)">50%</option>
                                <option value="0.35" data-description="تعتيم متوسط لمسة جمالية راقية (مطابق للأنظمة)">35%</option>
                                <option value="0.25" data-description="تعتيم عالي خصوصية وأناقة ملفتة">25%</option>
                                <option value="0.15" data-description="تعتيم شديد خصوصية عالية جذابة بدون كتم">15%</option>
                                <option value="0.05" data-description="تعتيم تام حجب كامل للرؤية من الخارج للداخل">5%</option>
                            </select>
                        </div>
                        <div class="vlt-description-display" id="rear_doors_vlt_desc"></div>
                    </div>

                    <div class="glass-tint-section mb-2 pb-2 border-b border-ts-gray-200 hidden" id="rear-quarter-glass-section">
                        <div class="flex justify-between items-center mb-1">
                            <h4 class="text-sm font-semibold flex items-center whitespace-nowrap"><i class="fas fa-vector-square fa-fw glass-icon ml-1.5 text-ts-blue text-sm"></i>زجاج الجوانب الخلفية*</h4>
                            <select class="vlt-select w-full p-2 border rounded-md bg-white text-xs mr-2" id="rear_quarter_vlt" name="rear_quarter_vlt">
                                <option value="" data-description="" selected>اختر درجة</option>
                                <option value="0.80" data-description="شفاف تمامًا غير ملحوظ تقريبًا (مطابق للأنظمة)">80%</option>
                                <option value="0.70" data-description="شفاف بالكاد يٌلاحظ (مطابق للأنظمة)">70%</option>
                                <option value="0.50" data-description="تعتيم خفيف توازن أنيق (مطابق للأنظمة)">50%</option>
                                <option value="0.35" data-description="تعتيم متوسط أنيق لمسة جمالية راقية (مطابق للأنظمة)">35%</option>
                                <option value="0.25" data-description="تعتيم عالي خصوصية وأناقة ملفتة (مطابق للأنظمة)">25%</option>
                                <option value="0.15" data-description="تعتيم شديد خصوصية عالية جذابة بدون كتم">15%</option>
                                <option value="0.05" data-description="تعتيم تام حجب كامل للرؤية من الخارج للداخل">5%</option>
                            </select>
                        </div>
                        <div class="vlt-description-display" id="rear_quarter_vlt_desc"></div>
                    </div>

                    <div class="glass-tint-section mb-2 pb-2 border-b border-ts-gray-200" id="rear-window-section">
                        <div class="flex justify-between items-center mb-1">
                             <h4 class="text-sm font-semibold flex items-center whitespace-nowrap"><i class="fas fa-window-minimize fa-fw glass-icon ml-1.5 text-ts-blue text-sm"></i>الزجاج الخلفي*</h4>
                            <select class="vlt-select w-full p-2 border rounded-md bg-white text-xs mr-2" id="rear_window_vlt" name="rear_window_vlt">
                                <option value="" data-description="" selected>اختر درجة</option>
                                <option value="0.80" data-description="شفاف تمامًا غير ملحوظ تقريبًا (مطابق للأنظمة)">80%</option>
                                <option value="0.70" data-description="شفاف بالكاد يٌلاحظ (مطابق للأنظمة)">70%</option>
                                <option value="0.50" data-description="تعتيم خفيف توازن أنيق (مطابق للأنظمة)">50%</option>
                                <option value="0.35" data-description="تعتيم متوسط أنيق. لمسة جمالية راقية (مطابق للأنظمة)">35%</option>
                                <option value="0.25" data-description="تعتيم عالي خصوصية وأناقة ملفتة">25%</option>
                                <option value="0.15" data-description="تعتيم شديد خصوصية عالية جذابة بدون كتم">15%</option>
                                <option value="0.05" data-description="تعتيم تام حجب كامل للرؤية من الخارج للداخل">5%</option>
                            </select>
                        </div>
                        <div class="vlt-description-display" id="rear_window_vlt_desc"></div>
                    </div>

                    <div class="glass-tint-section mb-2" id="sunroof-section"> 
                        <div class="flex justify-between items-center mb-1">
                            <h4 class="text-sm font-semibold flex items-center whitespace-nowrap"><i class="far fa-sun fa-fw glass-icon ml-1.5 text-ts-blue text-sm"></i>فتحة السقف</h4>
                             <div class="w-full mr-2"> 
                                <label for="sunroof_type" class="block text-xs font-medium text-ts-gray-500 sr-only">نوع فتحة السقف:</label> 
                                <select id="sunroof_type" name="sunroof_type" class="sunroof-type-select vlt-select w-full p-2 border rounded-md bg-white text-xs"> 
                                    <option value="none" data-description="" selected>بدون فتحة سقف</option>
                                    <option value="normal" data-description="فتحة سقف بحجم عادي">عادية</option>
                                    <option value="panoramic" data-description="فتحة سقف بانورامية واسعة">بانورامية</option>
                                </select>
                             </div>
                        </div>
                        <div class="vlt-description-display" id="sunroof_type_desc"></div>
                        
                        <p class="sunroof-note text-xs text-ts-gray-500 mt-1 mb-1.5"><small></small></p> 
                        
                        <div id="sunroof_tint_options_wrapper" class="hidden">
                             <div class="flex justify-between items-center mb-1">
                                <label for="sunroof_vlt" class="text-sm font-semibold flex items-center whitespace-nowrap">تظليل فتحة السقف:</label>
                                <select class="vlt-select w-full p-2 border rounded-md bg-white text-xs mr-2" id="sunroof_vlt" name="sunroof_vlt">
                                    <option value="" data-description="" selected>اختر درجة</option>
                                    <option value="0.80" data-description="شفاف تمامًا لفتحة السقف">80%</option>
                                    <option value="0.70" data-description="شفاف لفتحة السقف">70%</option>
                                    <option value="0.50" data-description="تعتيم خفيف لفتحة السقف">50%</option>
                                    <option value="0.35" data-description="تعتيم متوسط لفتحة السقف">35%</option>
                                    <option value="0.25" data-description="تعتيم عالي لفتحة السقف">25%</option>
                                    <option value="0.15" data-description="تعتيم شديد لفتحة السقف">15%</option>
                                    <option value="0.05" data-description="تعتيم تام لفتحة السقف">5%</option>
                                </select>
                            </div>
                            <div class="vlt-description-display" id="sunroof_vlt_desc"></div>
                        </div>
                    </div>
                </section>

                <div class="controls-footer mt-auto pt-3 text-center"> 
                    <button id="nextButton" class="btn-next w-full bg-ts-blue hover:bg-ts-blue-dark text-white font-bold py-2.5 px-5 rounded-lg shadow-md hover:shadow-lg transition-all duration-200" onclick="goToNext()" disabled> 
                        <span class="ml-2 text-sm">استمر في التخصيص</span><i class="fas fa-arrow-left arrow-icon text-xs"></i> 
                    </button>
                </div>
            </aside>

            <div class="simulation-preview-area lg:w-7/12 xl:w-8/12 bg-gradient-to-br from-ts-gray-700 to-ts-gray-900 rounded-xl shadow-xl flex items-center justify-center p-4 md:p-6 relative order-1 lg:order-2 min-h-[350px] sm:min-h-[450px] lg:min-h-[500px]">
                <img loading="lazy" id="previewImage" src="https://placehold.co/800x500/e0e0e0/333?text=اختر+سيارة+للمعاينة&font=cairo" alt="معاينة السيارة المختارة" class="max-w-full max-h-[calc(100vh-12rem)] h-auto object-contain rounded-lg shadow-2xl z-10">
                <div id="tint-overlay" class="absolute inset-0 bg-black/5 rounded-lg z-20 pointer-events-none transition-colors duration-300 ease-in-out" style="background-color: rgba(0,0,0,0.05);"></div>
            </div>
        </main>
    </div>

    <script>
        let selectedCarInfo = {
            name: null,
            image: null,
            tintVLT: 0.05, 
            detailedTints: {}
        };

        const previewImage = document.getElementById('previewImage');
        const tintOverlay = document.getElementById('tint-overlay');
        const tintLabel = document.getElementById('tintLabel');
        const nextButton = document.getElementById('nextButton');
        const alertContainer = document.getElementById('alert-message-container');

        function showTemporaryAlert(message, type = 'error') { 
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert-message alert-${type}`; 
            alertDiv.textContent = message;
            
            alertContainer.innerHTML = ''; 
            alertContainer.appendChild(alertDiv);
            alertContainer.classList.remove('opacity-0', '-translate-y-10');
            alertContainer.classList.add('opacity-100', 'translate-y-0');

            setTimeout(() => {
                alertContainer.classList.remove('opacity-100', 'translate-y-0');
                alertContainer.classList.add('opacity-0', '-translate-y-10');
                setTimeout(() => alertContainer.innerHTML = '', 300);
            }, 3000);
        }


        function applyGeneralTintToPreview(vlt) {
            if (tintOverlay) {
                const overlayOpacity = 1 - vlt;
                tintOverlay.style.backgroundColor = `rgba(0, 0, 0, ${overlayOpacity.toFixed(2)})`;
            }
            if (tintLabel) {
                if (vlt === 1) {
                    tintLabel.textContent = `التظليل العام المختار: بدون`;
                } else {
                    tintLabel.textContent = `التظليل العام المختار: ${Math.round(vlt * 100)}% VLT`;
                }
            }
        }

        function selectTint(vlt, element) {
            selectedCarInfo.tintVLT = vlt;
            applyGeneralTintToPreview(vlt);

            document.querySelectorAll('.tint-button').forEach(el => el.classList.remove('selected-tint'));
            if (element) {
                element.classList.add('selected-tint');
            }
            localStorage.setItem('selectedTintVLT', selectedCarInfo.tintVLT);
        }

        function selectCar(carName, imagePath, element) {
            previewImage.src = imagePath;
            previewImage.alt = "معاينة " + carName;

            selectedCarInfo.name = carName;
            selectedCarInfo.image = imagePath;
            
            document.querySelectorAll('.vehicle-option').forEach(el => el.classList.remove('selected-vehicle'));
            if (element) { // Ensure element is not null
                element.classList.add('selected-vehicle');
            }

            localStorage.setItem('selectedCarName', selectedCarInfo.name);
            localStorage.setItem('selectedCarPreviewImage', selectedCarInfo.image);
            
            nextButton.disabled = false;

            const rearQuarterGlassSection = document.getElementById('rear-quarter-glass-section');
            if (rearQuarterGlassSection) {
                if (carName === 'عائلية/دفع رباعي') {
                    rearQuarterGlassSection.classList.remove('hidden');
                } else {
                    rearQuarterGlassSection.classList.add('hidden');
                    const rearQuarterVltSelect = document.getElementById('rear_quarter_vlt');
                    const rearQuarterDescDisplay = document.getElementById('rear_quarter_vlt_desc');
                    if (rearQuarterVltSelect) { rearQuarterVltSelect.value = ""; }
                    if (rearQuarterDescDisplay) { rearQuarterDescDisplay.textContent = ''; rearQuarterDescDisplay.classList.remove('visible');}
                    if (selectedCarInfo.detailedTints) { delete selectedCarInfo.detailedTints['rear_quarter_vlt']; }
                    localStorage.removeItem('rear_quarter_vlt'); 
                }
            }
        }

        function goToNext() {
            if (!selectedCarInfo.name) {
                showTemporaryAlert("الرجاء اختيار فئة السيارة أولاً."); 
                return;
            }
            console.log("Selected Car Info before navigating:", JSON.stringify(selectedCarInfo, null, 2));
            showTemporaryAlert(`تم اختيار ${selectedCarInfo.name}. جاهز للانتقال (الوجهة: customization.html)`, 'success');
        }

        document.addEventListener('DOMContentLoaded', () => {
            const storedCarName = localStorage.getItem('selectedCarName');
            const storedCarImage = localStorage.getItem('selectedCarPreviewImage');
            const storedGeneralTintVLT = localStorage.getItem('selectedTintVLT');
            
            let initialCarName = null;
            let initialCarImage = "https://placehold.co/800x500/e0e0e0/333?text=اختر+سيارة+للمعاينة&font=cairo";
            let initialGeneralTintVLT = 0.05; 

            if (storedCarName && storedCarImage) {
                initialCarName = storedCarName;
                initialCarImage = storedCarImage;
                selectedCarInfo.name = initialCarName;
                selectedCarInfo.image = initialCarImage;
                nextButton.disabled = false;
                 // Call selectCar here to apply 'selected-vehicle' class
                const carButtonToSelect = document.querySelector(`.vehicle-option[data-car-name="${initialCarName}"]`);
                if (carButtonToSelect) {
                    selectCar(initialCarName, initialCarImage, carButtonToSelect); 
                }

            } else {
                nextButton.disabled = true;
            }

            if (storedGeneralTintVLT !== null) {
                const parsedVLT = parseFloat(storedGeneralTintVLT);
                const validVLTs = [0.05, 0.15, 0.25, 0.35, 0.50, 0.70, 0.80, 1.00];
                if (validVLTs.includes(parsedVLT)) {
                    initialGeneralTintVLT = parsedVLT;
                }
            }

            previewImage.src = initialCarImage;
            previewImage.alt = initialCarName ? "معاينة " + initialCarName : "اختر سيارة للمعاينة";
            // Vehicle selection is handled above if storedCarName exists

            let generalTintButtonToSelect = document.querySelector(`.tint-button[data-vlt="${initialGeneralTintVLT.toFixed(2)}"]`);
             if (!generalTintButtonToSelect) { 
                generalTintButtonToSelect = document.querySelector(`.tint-button[data-vlt="${initialGeneralTintVLT}"]`);
            }
            if (generalTintButtonToSelect) {
                selectTint(initialGeneralTintVLT, generalTintButtonToSelect);
            } else {
                const defaultTintButton = document.querySelector('.tint-button[data-vlt="0.05"]');
                if(defaultTintButton) selectTint(0.05, defaultTintButton);
            }
            
            const rearQuarterGlassSection = document.getElementById('rear-quarter-glass-section');
            function updateRearQuarterGlassVisibility(selectedCarName) {
                if (rearQuarterGlassSection) {
                    if (selectedCarName === 'عائلية/دفع رباعي') {
                        rearQuarterGlassSection.classList.remove('hidden');
                    } else {
                        rearQuarterGlassSection.classList.add('hidden');
                    }
                }
            }
            updateRearQuarterGlassVisibility(initialCarName);

            const detailedTintSelects = document.querySelectorAll('.detailed-tint-selection .vlt-select');
            detailedTintSelects.forEach(selectElement => {
                const descriptionDisplayElementId = selectElement.id + '_desc';
                const descriptionDisplayElement = document.getElementById(descriptionDisplayElementId);

                function updateDescriptionDisplay(currentSelect) {
                    if (descriptionDisplayElement) {
                        const selectedOption = currentSelect.options[currentSelect.selectedIndex];
                        const description = selectedOption ? selectedOption.dataset.description : "";
                        if (description && currentSelect.value !== "") {
                            descriptionDisplayElement.textContent = description;
                            descriptionDisplayElement.classList.add('visible');
                        } else {
                            descriptionDisplayElement.textContent = '';
                            descriptionDisplayElement.classList.remove('visible');
                        }
                    }
                }

                const storedDetailedValue = localStorage.getItem(selectElement.id);
                if(storedDetailedValue) {
                    selectElement.value = storedDetailedValue;
                    if (selectElement.id !== 'sunroof_type') { 
                       selectedCarInfo.detailedTints[selectElement.id] = storedDetailedValue;
                    }
                }
                updateDescriptionDisplay(selectElement); 

                selectElement.addEventListener('change', function() {
                    updateDescriptionDisplay(this);
                    
                    if (this.id !== 'sunroof_type') {
                        selectedCarInfo.detailedTints[this.id] = this.value;
                        localStorage.setItem(this.id, this.value);
                    } else { 
                        localStorage.setItem(this.id, this.value);
                        if(this.id === 'sunroof_type') updateSunroofControls();
                    }
                });
            });

            const sunroofTypeSelect = document.getElementById('sunroof_type');
            const sunroofVltWrapper = document.getElementById('sunroof_tint_options_wrapper');
            const sunroofVltSelect = document.getElementById('sunroof_vlt');
            
            function updateSunroofControls() {
                if(!sunroofTypeSelect || !sunroofVltWrapper || !sunroofVltSelect) return;

                const sunroofVltDescDisplay = document.getElementById('sunroof_vlt_desc'); 

                if (sunroofTypeSelect.value === 'none') {
                    sunroofVltWrapper.classList.add('hidden');
                    sunroofVltSelect.value = ""; 
                    if(sunroofVltDescDisplay) { sunroofVltDescDisplay.textContent = ''; sunroofVltDescDisplay.classList.remove('visible');}
                    if (selectedCarInfo.detailedTints) delete selectedCarInfo.detailedTints[sunroofVltSelect.id]; 
                    localStorage.removeItem(sunroofVltSelect.id);
                } else {
                    sunroofVltWrapper.classList.remove('hidden');
                    const storedSunroofVLT = localStorage.getItem(sunroofVltSelect.id);
                    if (storedSunroofVLT) {
                        sunroofVltSelect.value = storedSunroofVLT;
                        selectedCarInfo.detailedTints[sunroofVltSelect.id] = storedSunroofVLT;
                    }
                    if (sunroofVltSelect.options[sunroofVltSelect.selectedIndex] && sunroofVltDescDisplay) {
                        const selectedSunroofOption = sunroofVltSelect.options[sunroofVltSelect.selectedIndex];
                        const description = selectedSunroofOption.dataset.description;
                         if (description && sunroofVltSelect.value !== "") {
                            sunroofVltDescDisplay.textContent = description;
                            sunroofVltDescDisplay.classList.add('visible');
                        } else {
                            sunroofVltDescDisplay.textContent = '';
                            sunroofVltDescDisplay.classList.remove('visible');
                        }
                    }
                }
            }
            
            if (sunroofTypeSelect) {
                const storedSunroofType = localStorage.getItem('sunroof_type');
                if(storedSunroofType) {
                    sunroofTypeSelect.value = storedSunroofType;
                }
                updateSunroofControls(); 
            }

            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                });
            }
        });
    </script>
</body>
</html>
