<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محاكي تظليل وحماية السيارات - TopShield</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Cairo', 'sans-serif']
                    },
                    colors: {
                        'ts-blue': '#102E6A',  
                        'ts-blue-dark': '#0A2351',
                        'ts-blue-light': '#4A6FA5',
                        'ts-gold': '#FFC107',
                        'ts-gold-light': '#FFF8E1',
                        'ts-gray': {
                            50: '#F9FAFB',
                            100: '#F3F4F6',
                            200: '#E5E7EB',
                            300: '#D1D5DB',
                            400: '#9CA3AF',
                            500: '#6B7280',
                            600: '#4B5563',
                            700: '#374151',
                            800: '#1F2937',
                            900: '#111827'
                        }
                    },
                    boxShadow: {
                        'card': '0 5px 15px rgba(0, 0, 0, 0.08)',
                        'card-hover': '0 10px 20px rgba(0, 0, 0, 0.12)',
                        'selected': '0 0 0 3px rgba(255, 193, 7, 0.6)',
                        'selected-blue': '0 0 0 3px rgba(16, 46, 106, 0.5)',
                    },
                }
            }
        }
    </script>
    <style>
        body { background-color: tailwind.config.theme.extend.colors['ts-gray'][100]; }

        .car-type-icon.selected {
            border-color: tailwind.config.theme.extend.colors['ts-gold'] !important;
            background-color: tailwind.config.theme.extend.colors['ts-gold-light'] !important;
            box-shadow: tailwind.config.theme.extend.boxShadow['selected'];
            transform: translateY(-2px);
        }
        .car-type-icon.selected img { filter: none; }
        .car-type-icon.selected span { color: tailwind.config.theme.extend.colors['ts-blue-dark']; font-weight: 700; }

        .tab-button.active {
            background-color: tailwind.config.theme.extend.colors['ts-blue'];
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .tint-level-button.selected {
            background-color: tailwind.config.theme.extend.colors['ts-blue-light'] !important;
            color: white !important;
            border-color: tailwind.config.theme.extend.colors['ts-blue'] !important;
            box-shadow: tailwind.config.theme.extend.boxShadow['selected-blue'];
            transform: scale(1.05);
        }
        .parts-selector input[type="checkbox"]:checked + label {
            background-color: tailwind.config.theme.extend.colors['ts-blue-light'];
            color: white;
            border-color: tailwind.config.theme.extend.colors['ts-blue'];
        }
        .simulation-preview-container img, .simulation-preview-container div#tint-effect-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain; 
            border-radius: inherit; 
        }
         .simulation-preview-container {
            position: relative; 
            border-radius: 0.75rem; /* rounded-xl */
            background-color: tailwind.config.theme.extend.colors['ts-gray'][800]; /* Fallback bg */
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="text-ts-gray-700 antialiased">

<header class="bg-ts-blue text-white shadow-lg sticky top-0 z-50 h-20 flex items-center">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between w-full">
    <a href="#" class="logo flex items-center space-x-reverse space-x-3">
      <img src="icons/topshield_logo.png" alt="شعار Topshield" class="h-10 sm:h-12 object-contain" onerror="this.src='https://placehold.co/100x50/102E6A/FFFFFF?text=LOGO&font=cairo'; this.onerror=null;">
      <span class="font-bold text-2xl tracking-tight hidden sm:block">TopShield</span>
    </a>
    <h1 class="text-xl sm:text-2xl font-bold text-center flex-grow sm:flex-grow-0">محاكي التظليل والحماية</h1>
    <button id="mobile-menu-toggle" class="md:hidden text-white hover:text-ts-gold focus:outline-none">
      <i class="fas fa-bars text-2xl"></i>
    </button>
  </div>
  <!-- Mobile menu can be added here if needed -->
</header>

<main class="container mx-auto p-4 lg:p-6 mt-4 mb-8">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
        <!-- Right Panel: Controls -->
        <aside class="lg:col-span-5 bg-white rounded-xl shadow-xl p-5 space-y-6 order-2 lg:order-1 overflow-y-auto no-scrollbar" style="max-height: calc(100vh - 8rem);">
            <section id="car-selector-section">
              <h2 class="text-lg font-bold text-ts-blue-dark border-b-2 border-ts-blue pb-2 mb-4 flex items-center">
                <i class="fas fa-car text-ts-blue-light mr-2.5"></i>1. اختر نوع سيارتك:
              </h2>
              <div class="car-types-grid grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-2 gap-3">
                <div class="car-type-icon group p-3 border-2 border-ts-gray-200 rounded-lg hover:border-ts-gold hover:bg-ts-gold-light transition-all cursor-pointer text-center" 
                     data-car-type="sedan" data-car-name="سيدان" 
                     data-base-image="images/sedan_preview.png" 
                     data-overlay-image="images/sedan_overlay_transparent.png">
                  <img src="icons/sedan_selector_icon.png" alt="سيدان" class="w-16 h-10 mx-auto mb-1.5 filter grayscale group-hover:filter-none" onerror="this.src='https://placehold.co/64x40/cccccc/333?text=سيدان&font=cairo';this.onerror=null;">
                  <span class="text-xs font-medium text-ts-gray-700 group-hover:text-ts-blue-dark">سيدان</span>
                </div>
                <div class="car-type-icon group p-3 border-2 border-ts-gray-200 rounded-lg hover:border-ts-gold hover:bg-ts-gold-light transition-all cursor-pointer text-center" 
                     data-car-type="suv" data-car-name="دفع رباعي"
                     data-base-image="images/suv_preview.png"
                     data-overlay-image="images/suv_overlay_transparent.png">
                  <img src="icons/suv_selector_icon.png" alt="دفع رباعي" class="w-16 h-10 mx-auto mb-1.5 filter grayscale group-hover:filter-none" onerror="this.src='https://placehold.co/64x40/cccccc/333?text=SUV&font=cairo';this.onerror=null;">
                  <span class="text-xs font-medium text-ts-gray-700 group-hover:text-ts-blue-dark">دفع رباعي</span>
                </div>
                <div class="car-type-icon group p-3 border-2 border-ts-gray-200 rounded-lg hover:border-ts-gold hover:bg-ts-gold-light transition-all cursor-pointer text-center" 
                     data-car-type="sport" data-car-name="رياضية"
                     data-base-image="images/sport_preview.png"
                     data-overlay-image="images/sport_overlay_transparent.png">
                  <img src="icons/sport_selector_icon.png" alt="رياضية" class="w-16 h-10 mx-auto mb-1.5 filter grayscale group-hover:filter-none" onerror="this.src='https://placehold.co/64x40/cccccc/333?text=رياضية&font=cairo';this.onerror=null;">
                  <span class="text-xs font-medium text-ts-gray-700 group-hover:text-ts-blue-dark">رياضية</span>
                </div>
                <div class="car-type-icon group p-3 border-2 border-ts-gray-200 rounded-lg hover:border-ts-gold hover:bg-ts-gold-light transition-all cursor-pointer text-center" 
                     data-car-type="truck" data-car-name="شاحنة"
                     data-base-image="images/truck_preview.png"
                     data-overlay-image="images/truck_overlay_transparent.png">
                  <img src="icons/truck_selector_icon.png" alt="شاحنة" class="w-16 h-10 mx-auto mb-1.5 filter grayscale group-hover:filter-none" onerror="this.src='https://placehold.co/64x40/cccccc/333?text=شاحنة&font=cairo';this.onerror=null;">
                  <span class="text-xs font-medium text-ts-gray-700 group-hover:text-ts-blue-dark">شاحنة</span>
                </div>
              </div>
            </section>

            <section id="service-type-section">
              <h2 class="text-lg font-bold text-ts-blue-dark border-b-2 border-ts-blue pb-2 mb-4 flex items-center">
                <i class="fas fa-shield-alt text-ts-blue-light mr-2.5"></i>2. اختر نوع الخدمة:
              </h2>
              <div class="tabs flex gap-2 bg-ts-gray-100 p-1 rounded-lg">
                <button class="tab-button flex-1 py-2 px-3 rounded-md text-sm font-semibold transition-all duration-200 ease-in-out" data-service="tint">تظليل النوافذ</button>
                <button class="tab-button flex-1 py-2 px-3 rounded-md text-sm font-semibold transition-all duration-200 ease-in-out" data-service="ppf">أفلام الحماية</button>
              </div>
            </section>

            <div id="options-panel-container">
                <h3 id="current-car-selection-title" class="text-md font-semibold text-ts-blue-dark mb-3 text-center p-2 bg-ts-gray-100 rounded-md">اختر سيارة ونوع خدمة لعرض الخيارات</h3>
                
                <div id="tint-options" class="options-content space-y-4 hidden">
                    <h4 class="text-md font-bold text-ts-gray-700 flex items-center"><i class="fas fa-adjust text-ts-blue-light mr-2"></i>خيارات تظليل النوافذ:</h4>
                    <div id="tint-level-selector">
                        <label class="block text-xs font-semibold text-ts-gray-600 mb-1.5">اختر درجة التظليل العامة:</label>
                        <div class="tint-level-grid flex flex-wrap justify-center gap-2">
                            <!-- Tint level buttons will be dynamically added here by JS -->
                        </div>
                    </div>
                    <hr class="my-3 border-ts-gray-200">
                    <div>
                        <label for="tint-parts" class="block text-xs font-semibold text-ts-gray-600 mb-1.5">اختر الأجزاء المراد تظليلها (اختياري):</label>
                        <div id="tint-parts-selector" class="parts-selector grid grid-cols-2 gap-2 text-xs">
                            <!-- Tint parts checkboxes will be dynamically added here by JS -->
                        </div>
                    </div>
                </div>

                <div id="ppf-options" class="options-content space-y-4 hidden">
                    <h4 class="text-md font-bold text-ts-gray-700 flex items-center"><i class="fas fa-film text-ts-blue-light mr-2"></i>خيارات أفلام الحماية (PPF):</h4>
                    <div>
                        <label for="ppf-parts" class="block text-xs font-semibold text-ts-gray-600 mb-1.5">اختر الأجزاء المراد حمايتها:</label>
                        <div id="ppf-parts-selector" class="parts-selector grid grid-cols-2 gap-2 text-xs">
                            <!-- PPF parts checkboxes will be dynamically added here by JS -->
                        </div>
                    </div>
                </div>
            </div>
            
            <section id="quote-section" class="mt-5 pt-4 border-t border-ts-gray-200">
              <h2 class="text-lg font-bold text-ts-blue-dark mb-2 flex items-center">
                <i class="fas fa-calculator text-ts-blue-light mr-2.5"></i>3. السعر التقديري:
              </h2>
              <p class="text-xl font-bold text-ts-blue text-center py-3 bg-ts-gold-light rounded-lg">
                <span id="estimated-price">0</span> ريال سعودي
              </p>
            </section>
        </aside>

        <!-- Left Panel: Preview -->
        <div class="lg:col-span-7 simulation-preview-container bg-gradient-to-br from-ts-gray-800 to-ts-gray-900 rounded-xl shadow-2xl flex items-center justify-center p-5 min-h-[350px] sm:min-h-[450px] lg:min-h-[500px] order-1 lg:order-2">
            <div id="no-car-selected-message-main" class="text-center text-ts-gray-400 text-lg font-semibold">
                <i class="fas fa-car-side fa-3x mb-3"></i><br>
                اختر سيارة ونوع خدمة لعرض المحاكاة.
            </div>
            <img id="previewImageBase" src="" alt="جسم السيارة" style="z-index: 10; display: none;">
            <div id="tint-effect-layer" style="z-index: 20; background-color: rgba(0,0,0,0.0); display: none;"></div>
            <img id="previewImageFrame" src="" alt="إطار السيارة مع زجاج شفاف" style="z-index: 30; pointer-events: none; display: none;">
        </div>
    </div>
</main>

<footer class="bg-ts-blue-dark text-ts-gray-200 py-6 text-center mt-auto">
    <p class="text-sm">&copy; <span id="current-year"></span> TOPSHIELD LLC. جميع الحقوق محفوظة.</p>
</footer>

<script>
    // --- Data (Simulated - ideally from cars_data.js) ---
    const carsData = {
        sedan: {
            name: "سيدان",
            icon: "icons/sedan_selector_icon.png", // Used for car selection UI
            baseImage: "images/sedan_preview.png", // Main car body image
            overlayImage: "images/sedan_overlay_transparent.png", // Car frame with transparent windows
            tintParts: { "الزجاج الأمامي": 50, "النوافذ الجانبية الأمامية": 70, "النوافذ الجانبية الخلفية": 70, "الزجاج الخلفي": 50, "فتحة السقف": 30 },
            ppfParts: { "المقدمة كاملة": 300, "غطاء المحرك": 100, "الصدام الأمامي": 80, "الرفارف الأمامية": 70, "المرايا الجانبية": 40 }
        },
        suv: {
            name: "دفع رباعي",
            icon: "icons/suv_selector_icon.png",
            baseImage: "images/suv_preview.png",
            overlayImage: "images/suv_overlay_transparent.png",
            tintParts: { "الزجاج الأمامي": 60, "النوافذ الجانبية الأمامية": 80, "النوافذ الجانبية الخلفية": 80, "زجاج الربع الخلفي": 40, "الزجاج الخلفي": 60, "فتحة السقف البانورامية": 70 },
            ppfParts: { "المقدمة كاملة": 350, "غطاء المحرك": 120, "الصدام الأمامي": 90, "الرفارف الأمامية": 80, "المرايا الجانبية": 45, "عتبات الأبواب": 50 }
        },
        sport: {
            name: "رياضية",
            icon: "icons/sport_selector_icon.png",
            baseImage: "images/sport_preview.png",
            overlayImage: "images/sport_overlay_transparent.png",
            tintParts: { "الزجاج الأمامي": 40, "النوافذ الجانبية": 100, "الزجاج الخلفي": 40 },
            ppfParts: { "المقدمة كاملة": 400, "غطاء المحرك": 150, "الصدام الأمامي": 100, "الرفارف الأمامية": 90 }
        },
        truck: {
            name: "شاحنة",
            icon: "icons/truck_selector_icon.png",
            baseImage: "images/truck_preview.png",
            overlayImage: "images/truck_overlay_transparent.png",
            tintParts: { "الزجاج الأمامي": 70, "النوافذ الجانبية الأمامية": 90, "النوافذ الجانبية الخلفية (غمارتين)": 90, "الزجاج الخلفي": 70 },
            ppfParts: { "المقدمة كاملة": 380, "غطاء المحرك": 140, "الصدام الأمامي": 100, "الرفارف الأمامية": 85 }
        }
    };

    const tintLevels = [
        { name: "5%", vlt: 0.05, color: 'bg-black/95', textColor: 'text-white' },
        { name: "15%", vlt: 0.15, color: 'bg-black/85', textColor: 'text-white' },
        { name: "25%", vlt: 0.25, color: 'bg-black/75', textColor: 'text-white' },
        { name: "35%", vlt: 0.35, color: 'bg-black/65', textColor: 'text-white' },
        { name: "50%", vlt: 0.50, color: 'bg-black/50', textColor: 'text-white' },
        { name: "70%", vlt: 0.70, color: 'bg-black/30', textColor: 'text-ts-gray-800' },
        { name: "80%", vlt: 0.80, color: 'bg-black/20', textColor: 'text-ts-gray-800' },
        { name: "بدون", vlt: 1.00, color: 'bg-transparent border-dashed', textColor: 'text-ts-gray-600' }
    ];

    // --- DOM Elements ---
    const carTypeIcons = document.querySelectorAll('.car-type-icon');
    const tabButtons = document.querySelectorAll('.tab-button');
    const tintOptionsDiv = document.getElementById('tint-options');
    const ppfOptionsDiv = document.getElementById('ppf-options');
    const currentCarSelectionTitle = document.getElementById('current-car-selection-title');
    const tintLevelGrid = document.querySelector('#tint-level-selector .tint-level-grid');
    const tintPartsSelector = document.getElementById('tint-parts-selector');
    const ppfPartsSelector = document.getElementById('ppf-parts-selector');
    const previewImageBase = document.getElementById('previewImageBase');
    const tintEffectLayer = document.getElementById('tint-effect-layer');
    const previewImageFrame = document.getElementById('previewImageFrame');
    const noCarMessageMain = document.getElementById('no-car-selected-message-main');
    const estimatedPriceSpan = document.getElementById('estimated-price');
    const currentYearSpan = document.getElementById('current-year');
    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');

    // --- State ---
    let selectedCarType = null;
    let selectedService = 'tint'; // Default to tint
    let currentGeneralVLT = 1.0; // Default to no tint
    let selectedTintParts = {};
    let selectedPpfParts = {};

    // --- Functions ---
    function updateCarSelectionDisplay() {
        if (selectedCarType && carsData[selectedCarType]) {
            currentCarSelectionTitle.textContent = `السيارة المختارة: ${carsData[selectedCarType].name} | الخدمة: ${selectedService === 'tint' ? 'تظليل' : 'حماية'}`;
            previewImageBase.src = carsData[selectedCarType].baseImage;
            previewImageFrame.src = carsData[selectedCarType].overlayImage;
            previewImageBase.style.display = 'block';
            tintEffectLayer.style.display = 'block';
            previewImageFrame.style.display = 'block';
            noCarMessageMain.style.display = 'none';
            applyTintEffect();
        } else {
            currentCarSelectionTitle.textContent = "اختر سيارة ونوع خدمة لعرض الخيارات";
            previewImageBase.style.display = 'none';
            tintEffectLayer.style.display = 'none';
            previewImageFrame.style.display = 'none';
            noCarMessageMain.style.display = 'block';
        }
        updateOptionsDisplay();
        calculatePrice();
    }

    function populateTintLevels() {
        tintLevelGrid.innerHTML = '';
        tintLevels.forEach(level => {
            const button = document.createElement('button');
            button.className = `tint-level-button w-14 h-14 rounded-lg border-2 border-ts-gray-300 flex flex-col items-center justify-center font-semibold text-xs hover:scale-105 transition-transform ${level.color} ${level.textColor}`;
            button.dataset.vlt = level.vlt;
            button.textContent = level.name;
            button.onclick = () => selectTintLevel(level.vlt, button);
            tintLevelGrid.appendChild(button);
            if (level.vlt === currentGeneralVLT) {
                button.classList.add('selected');
            }
        });
    }
    
    function selectTintLevel(vlt, element) {
        currentGeneralVLT = vlt;
        document.querySelectorAll('.tint-level-button').forEach(btn => btn.classList.remove('selected'));
        element.classList.add('selected');
        applyTintEffect();
        calculatePrice();
    }

    function applyTintEffect() {
        if (selectedService === 'tint' && selectedCarType) {
            const opacity = 1 - currentGeneralVLT;
            tintEffectLayer.style.backgroundColor = `rgba(0, 0, 0, ${opacity.toFixed(2)})`;
        } else {
            tintEffectLayer.style.backgroundColor = 'rgba(0,0,0,0)'; // No tint for PPF or if no car
        }
    }

    function populateParts(service) {
        const partsSelector = service === 'tint' ? tintPartsSelector : ppfPartsSelector;
        partsSelector.innerHTML = '';
        const carData = carsData[selectedCarType];
        if (!carData) return;

        const parts = service === 'tint' ? carData.tintParts : carData.ppfParts;
        if (!parts) return;

        Object.keys(parts).forEach(partName => {
            const id = `${service}-${partName.replace(/\s+/g, '-')}`;
            const wrapper = document.createElement('div');
            wrapper.className = 'flex items-center';
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = id;
            checkbox.value = partName;
            checkbox.className = 'hidden';
            checkbox.onchange = (event) => handlePartSelection(service, partName, event.target.checked);
            
            const label = document.createElement('label');
            label.htmlFor = id;
            label.className = 'flex-grow p-2 border border-ts-gray-300 rounded-md cursor-pointer hover:bg-ts-gray-100 transition-colors text-center';
            label.textContent = partName;

            wrapper.appendChild(checkbox);
            wrapper.appendChild(label);
            partsSelector.appendChild(wrapper);
        });
    }
    
    function handlePartSelection(service, partName, isSelected) {
        const selectedPartsObject = service === 'tint' ? selectedTintParts : selectedPpfParts;
        if (isSelected) {
            selectedPartsObject[partName] = true;
        } else {
            delete selectedPartsObject[partName];
        }
        calculatePrice();
    }

    function updateOptionsDisplay() {
        if (selectedCarType) {
            tintOptionsDiv.style.display = selectedService === 'tint' ? 'block' : 'none';
            ppfOptionsDiv.style.display = selectedService === 'ppf' ? 'block' : 'none';
            if (selectedService === 'tint') {
                populateTintLevels();
                populateParts('tint');
            } else {
                populateParts('ppf');
            }
        } else {
            tintOptionsDiv.style.display = 'none';
            ppfOptionsDiv.style.display = 'none';
        }
    }
    
    function calculatePrice() {
        let totalPrice = 0;
        const carData = carsData[selectedCarType];
        if (!carData) {
            estimatedPriceSpan.textContent = '0';
            return;
        }

        if (selectedService === 'tint') {
            // Base price for general tint (example logic)
            if (currentGeneralVLT < 1.00) totalPrice += 150; // Base price if any tint is selected

            Object.keys(selectedTintParts).forEach(part => {
                if (carData.tintParts && carData.tintParts[part]) {
                    totalPrice += carData.tintParts[part];
                }
            });
        } else if (selectedService === 'ppf') {
            Object.keys(selectedPpfParts).forEach(part => {
                if (carData.ppfParts && carData.ppfParts[part]) {
                    totalPrice += carData.ppfParts[part];
                }
            });
        }
        estimatedPriceSpan.textContent = totalPrice;
    }

    // --- Event Listeners ---
    carTypeIcons.forEach(icon => {
        icon.addEventListener('click', () => {
            selectedCarType = icon.dataset.carType;
            document.querySelectorAll('.car-type-icon').forEach(i => i.classList.remove('selected'));
            icon.classList.add('selected');
            selectedTintParts = {}; // Reset parts on car change
            selectedPpfParts = {};  // Reset parts on car change
            updateCarSelectionDisplay();
        });
    });

    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            selectedService = button.dataset.service;
            tabButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            currentGeneralVLT = 1.0; // Reset general VLT when service changes
            selectedTintParts = {}; 
            selectedPpfParts = {};
            updateCarSelectionDisplay();
        });
    });

    if (mobileMenuToggle && mobileMenu) {
        mobileMenuToggle.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });
    }
    
    // --- Initialization ---
    currentYearSpan.textContent = new Date().getFullYear();
    updateCarSelectionDisplay(); // Initial call to set up UI based on default state
    // Activate the default tint tab
    document.querySelector('.tab-button[data-service="tint"]').classList.add('active');

</script>
</body>
</html>
